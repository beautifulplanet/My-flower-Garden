<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Flower Garden — A Botanical Journal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Pinyon+Script&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
/* styles.css - Victorian botanical journal theme */
@import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: 
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139,115,85,0.03) 2px, rgba(139,115,85,0.03) 3px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(139,115,85,0.03) 2px, rgba(139,115,85,0.03) 3px),
    radial-gradient(circle at 20% 30%, rgba(212,199,159,0.2) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(191,167,122,0.15) 0%, transparent 50%),
    linear-gradient(135deg, #f4f1e4 0%, #e8dcc8 100%);
  font-family: 'EB Garamond', 'Crimson Text', serif;
  color: #4a3b2c;
  min-height: 100vh;
  padding: 1rem;
  font-size: 18px;
  line-height: 1.6;
}

.game-container {
  max-width: 1400px;
  margin: 0 auto;
  background: 
    radial-gradient(circle at 10% 20%, rgba(139,115,85,0.04) 0%, transparent 50%),
    radial-gradient(circle at 90% 80%, rgba(139,115,85,0.04) 0%, transparent 50%),
    linear-gradient(to bottom, #fffbf0 0%, #fff9f0 50%, #faf6ea 100%);
  border: 3px solid #bfa77a;
  border-radius: 16px;
  box-shadow: 
    0 8px 32px rgba(60,40,20,0.15),
    inset 0 1px 0 rgba(255,255,255,0.6),
    inset 0 0 60px rgba(139,115,85,0.05);
  padding: 2rem;
  position: relative;
}

header {
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 2px solid #e8dcc8;
  padding-bottom: 1rem;
}

header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 2.8rem;
  letter-spacing: 2px;
  color: #5a4a3a;
  margin-bottom: 0.5rem;
}

.stats-bar {
  display: flex;
  justify-content: center;
  gap: 3rem;
  margin-top: 1rem;
}

.stat {
  font-size: 1.1rem;
}

.stat-label {
  font-weight: bold;
  color: #8b7355;
  margin-right: 0.5rem;
}

.game-panels {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}

.garden-panel {
  grid-column: 1 / -1;
  width: 100%;
}

.panel {
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(60,40,20,0.08);
}

.panel h2 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  margin-bottom: 1rem;
  border-bottom: 1px solid #e8dcc8;
  padding-bottom: 0.5rem;
  font-size: 1.5rem;
}

.panel h3 {
  color: #6a5a4a;
  margin: 1rem 0 0.5rem 0;
  font-size: 1.2rem;
}

.hint {
  font-style: italic;
  color: #8b7355;
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
}

/* Garden Grid */
.garden-view-toggle {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  justify-content: center;
}

.view-btn {
  background: #e8dcc8;
  color: #5a4a3a;
  border: 2px solid #bfa77a;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  cursor: pointer;
  font-family: 'EB Garamond', serif;
  font-size: 1rem;
  transition: all 0.2s;
}

.view-btn.active {
  background: #bfa77a;
  color: white;
}

.garden-grid {
  display: grid;
  grid-template-columns: repeat(4, 80px);
  grid-gap: 12px;
  margin: 1rem auto;
  justify-content: center;
  width: 100%;
  max-width: 100%;
}

.plot {
  width: 80px;
  height: 80px;
  background: #f4e9d8;
  border: 2px solid #bfa77a;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 2.5rem;
  transition: all 0.2s;
  position: relative;
}

.plant-emoji {
  font-size: 2.5rem;
  display: inline-block;
  transition: all 0.2s;
}

.plot:hover {
  background: #ebe0cf;
  transform: scale(1.05);
}

.plot.ready {
  background: #d4f4dd;
  box-shadow: 0 0 8px rgba(76,175,80,0.3);
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.garden-actions {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin-top: 1rem;
}

/* Seed Shop */
.seed-shop {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.seed-card {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}

.seed-card:hover {
  background: #f4f1e4;
  border-color: #bfa77a;
  transform: translateY(-2px);
}

.seed-card.selected {
  background: #e8f5e9;
  border-color: #4caf50;
  border-width: 3px;
}

.seed-emoji {
  font-size: 2rem;
  margin-bottom: 0.3rem;
}

.seed-name {
  font-weight: bold;
  color: #5a4a3a;
  margin-bottom: 0.2rem;
}

.seed-cost {
  color: #8b7355;
  font-weight: bold;
}

.seed-info {
  font-size: 0.85rem;
  color: #999;
}

/* Inventory */
.inventory {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
  max-height: 200px;
  overflow-y: auto;
}

.inventory-item {
  background: white;
  border: 1px solid #e8dcc8;
  border-radius: 6px;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.inventory-item:hover {
  background: #f4f1e4;
  transform: translateX(4px);
}

.inv-emoji {
  font-size: 1.5rem;
}

.inv-name {
  flex: 1;
  font-weight: bold;
}

.inv-count {
  color: #8b7355;
}

/* Bouquet Builder */
.bouquet-builder {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.current-bouquet {
  min-height: 80px;
  background: #f8f5e9;
  border: 2px dashed #bfa77a;
  border-radius: 6px;
  padding: 0.5rem;
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin: 0.5rem 0;
}

.bouquet-flower {
  font-size: 2rem;
  cursor: pointer;
  padding: 0.3rem;
  border-radius: 4px;
  transition: all 0.2s;
}

.bouquet-flower:hover {
  background: #ffe0e0;
  transform: rotate(-10deg);
}

.bouquet-value {
  text-align: right;
  font-weight: bold;
  color: #4caf50;
  margin: 0.5rem 0;
  font-size: 1.2rem;
}

/* Market */
.market-demand {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.demand-item {
  display: flex;
  justify-content: space-between;
  padding: 0.3rem 0;
  border-bottom: 1px solid #f0f0f0;
}

.demand-value {
  font-weight: bold;
}

.bouquets-for-sale {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
  max-height: 150px;
  overflow-y: auto;
}

.bouquet-card {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 0.8rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.bouquet-flowers {
  font-size: 1.5rem;
}

/* Action Buttons */
.action-btn {
  background: #bfa77a;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0.6rem 1.5rem;
  font-size: 1rem;
  font-family: 'EB Garamond', serif;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.action-btn:hover:not(:disabled) {
  background: #a68a5b;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.action-btn.primary {
  background: #8b7355;
}

.action-btn.warning {
  background: #c94f4f;
}

.action-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
}

/* Footer */
footer {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 2px solid #e8dcc8;
}

.shop-btn {
  background: #4caf50;
}

.shop-btn:hover {
  background: #3d8b40;
}

/* Modals */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: #fff9f0;
  border: 3px solid #bfa77a;
  border-radius: 16px;
  padding: 2rem;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.flower-shop-modal {
  max-width: 1200px;
}

.modal h2 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  margin-bottom: 1.5rem;
  text-align: center;
}

.help-content {
  line-height: 1.8;
}

.help-content h3 {
  color: #5a4a3a;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
}

/* Upgrades */
.upgrades-list {
  display: grid;
  gap: 1rem;
  margin-bottom: 1rem;
}

.upgrade-card {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.upgrade-name {
  font-weight: bold;
  color: #5a4a3a;
}

.upgrade-cost {
  color: #8b7355;
}

/* Shop Layout */
.shop-layout {
  display: grid;
  grid-template-columns: 1fr 2fr 1fr;
  gap: 1.5rem;
}

.shop-available-flowers {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
}

.shop-flower-item {
  font-size: 2rem;
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 0.5rem;
  text-align: center;
  cursor: pointer;
}

/* Notifications */
.notifications {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.notification {
  background: white;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem 1.5rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  animation: slideIn 0.3s ease-out;
  min-width: 250px;
}

.notification.success {
  border-color: #4caf50;
  background: #e8f5e9;
}

.notification.error {
  border-color: #c94f4f;
  background: #ffebee;
}

.notification.warning {
  border-color: #ff9800;
  background: #fff3e0;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

.hidden {
  display: none !important;
}

/* Visual Garden View */
.visual-garden {
  position: relative;
  width: 100%;
  height: 500px;
  background: linear-gradient(to bottom, #f4f1e4 0%, #e8dcc8 100%);
  border: 3px solid #8b7355;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: inset 0 0 20px rgba(139,115,85,0.1);
}

.visual-garden::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139,115,85,0.03) 2px, rgba(139,115,85,0.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(139,115,85,0.03) 2px, rgba(139,115,85,0.03) 4px);
  pointer-events: none;
}

.garden-sky {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 15%;
  background: linear-gradient(to bottom, rgba(244,241,228,0.5), transparent);
}

.sun {
  position: absolute;
  top: 10px;
  right: 30px;
  width: 40px;
  height: 40px;
  border: 2px solid #8b7355;
  border-radius: 50%;
  background: transparent;
  opacity: 0.3;
}

.sun::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 1px dashed #8b7355;
  opacity: 0.2;
}

.cloud {
  position: absolute;
  border: 1px solid #8b7355;
  border-radius: 20px;
  opacity: 0.2;
  background: transparent;
  animation: float 20s ease-in-out infinite;
}

.cloud-1 {
  width: 60px;
  height: 20px;
  top: 20px;
  left: 15%;
}

.cloud-2 {
  width: 70px;
  height: 22px;
  top: 30px;
  left: 70%;
  animation-delay: -10s;
}

@keyframes float {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(30px); }
}

.garden-scene {
  position: absolute;
  bottom: 0;
  left: 10%;
  right: 10%;
  top: 15%;
}

.soil-row {
  position: relative;
}

.soil-row::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(139,115,85,0.1) 20px, rgba(139,115,85,0.1) 21px);
  pointer-events: none;
}

.garden-ground {
  display: none;
}

.fence {
  display: none;
}

.path {
  display: none;
}

.visual-plants {
  position: relative;
  width: 100%;
  height: 100%;
}

.visual-plant {
  position: absolute;
  font-size: 2.5rem;
  cursor: pointer;
  transition: all 0.3s;
  filter: sepia(0.15) contrast(1.05);
  text-shadow: 1px 1px 2px rgba(90,74,58,0.2);
  transform: translateX(-50%);
}

.visual-plant:hover {
  transform: translateX(-50%) scale(1.15) translateY(-3px);
  filter: sepia(0.1) contrast(1.1);
}

.garden-decorations {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
}

.butterfly, .bee {
  position: absolute;
  font-size: 1.2rem;
  opacity: 0.4;
  filter: sepia(0.3);
  animation: fly 15s ease-in-out infinite;
}

.butterfly-1 {
  top: 15%;
  left: 20%;
}

.butterfly-2 {
  top: 25%;
  right: 25%;
  animation-delay: -7s;
}

.bee {
  top: 20%;
  left: 60%;
  animation-delay: -3s;
}

@keyframes fly {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(30px, -15px); }
  50% { transform: translate(60px, 10px); }
  75% { transform: translate(20px, -5px); }
}

/* Arrangement Canvas */
.arrangement-area {
  padding: 1rem;
}

.arrangement-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e8dcc8;
}

.arrangement-tools {
  display: flex;
  gap: 0.5rem;
}

.tool-btn {
  width: 32px;
  height: 32px;
  border: 2px solid #bfa77a;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.2s;
}

.tool-btn:hover {
  background: #f4f1e4;
  transform: scale(1.1);
}

.arrangement-canvas {
  position: relative;
  width: 400px;
  height: 400px;
  background: white;
  border: 3px solid #bfa77a;
  border-radius: 12px;
  margin: 0 auto 1rem;
  overflow: hidden;
}

.canvas-background {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at center, #fff9f0, #f4f1e4);
  opacity: 0.6;
}

.arrangement-flowers {
  position: relative;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.canvas-flower {
  position: absolute;
  font-size: 3rem;
  cursor: move;
  transition: opacity 0.2s;
  user-select: none;
}

.canvas-flower.selected {
  filter: drop-shadow(0 0 8px #4caf50);
}

.canvas-flower:hover {
  opacity: 0.8;
}

.vase {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 120px;
  background: linear-gradient(to bottom, #8B7355 0%, #6B5345 100%);
  border-radius: 0 0 40px 40px;
  z-index: 0;
  opacity: 0.3;
}

.arrangement-score {
  margin-top: 1rem;
}

.score-item {
  margin-bottom: 0.8rem;
}

.score-item span:first-child {
  display: inline-block;
  width: 120px;
  font-weight: bold;
  color: #5a4a3a;
}

.score-bar {
  display: inline-block;
  width: 200px;
  height: 20px;
  background: #e8dcc8;
  border-radius: 10px;
  overflow: hidden;
  vertical-align: middle;
}

.score-fill {
  height: 100%;
  transition: width 0.3s;
}

.score-fill.aesthetic {
  background: linear-gradient(90deg, #ff6b9d, #c44569);
}

.score-fill.trend {
  background: linear-gradient(90deg, #4facfe, #00f2fe);
}

.score-fill.harmony {
  background: linear-gradient(90deg, #43e97b, #38f9d7);
}

.total-value {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 2px solid #e8dcc8;
  font-size: 1.3rem;
  font-weight: bold;
  text-align: center;
  color: #4caf50;
}

/* Wrapper and Ribbon Selection */
.wrapper-selection, .ribbon-selection {
  margin: 1rem 0;
}

.wrapper-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.wrapper-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.8rem;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  background: white;
}

.wrapper-option:hover {
  background: #f4f1e4;
}

.wrapper-option.selected {
  border-color: #4caf50;
  background: #e8f5e9;
}

.wrapper-preview {
  width: 40px;
  height: 40px;
  border-radius: 4px;
  margin-bottom: 0.3rem;
}

.classic-wrap {
  background: linear-gradient(135deg, #f4f1e4, #e8dcc8);
}

.elegant-wrap {
  background: linear-gradient(135deg, #fff, #f0f0f0);
}

.rustic-wrap {
  background: linear-gradient(135deg, #d2b48c, #8b7355);
}

.luxury-wrap {
  background: linear-gradient(135deg, #ffd700, #ffed4e);
}

.ribbon-options {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.ribbon-option {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s;
  border: 3px solid transparent;
}

.ribbon-option:hover {
  transform: scale(1.1);
}

.ribbon-option.selected {
  border-color: #4caf50;
  box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
}

.shop-flower-item .count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #4caf50;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: bold;
}

.shop-flower-item {
  position: relative;
}
/* ===== BOTANICAL NOTEBOOK ADDITIONS ===== */

/* Always-visible money counter */
.money-corner {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #fff9f0;
  border: 3px solid #bfa77a;
  border-radius: 12px;
  padding: 12px 20px;
  box-shadow: 0 4px 16px rgba(60,40,20,0.25);
  z-index: 1000;
  font-family: 'EB Garamond', serif;
  font-size: 1.5rem;
  font-weight: bold;
  color: #5a4a3a;
  display: flex;
  align-items: center;
  gap: 8px;
}

.money-icon {
  font-size: 1.8rem;
}

/* Enhanced botanical notebook background */
body {
  background: #f4f1e4 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%23f4f1e4" width="100" height="100"/><line x1="0" y1="50" x2="100" y2="50" stroke="%23e8dcc8" stroke-width="0.5" opacity="0.3"/><line x1="0" y1="25" x2="100" y2="25" stroke="%23e8dcc8" stroke-width="0.3" opacity="0.2"/><line x1="0" y1="75" x2="100" y2="75" stroke="%23e8dcc8" stroke-width="0.3" opacity="0.2"/></svg>');
  background-size: 100% 40px;
}

.game-container {
  position: relative;
  background: linear-gradient(to bottom, #fff9f0 0%, #f8f5e9 100%);
  border: 4px double #bfa77a;
  box-shadow: 
    0 8px 32px rgba(60,40,20,0.15),
    inset 0 0 60px rgba(255,249,240,0.6);
}

/* Flower visuals using color-coded symbols */
.flower-visual {
  display: inline-block;
  font-size: 2.5rem;
  line-height: 1;
  filter: drop-shadow(2px 2px 3px rgba(90,74,58,0.3));
  transition: all 0.3s ease;
}

/* Color mapping for different flowers */
.flower-visual[data-color="red"] { color: #c41e3a; }
.flower-visual[data-color="pink"] { color: #ff69b4; }
.flower-visual[data-color="purple"] { color: #9370db; }
.flower-visual[data-color="blue"] { color: #4169e1; }
.flower-visual[data-color="yellow"] { color: #ffd700; }
.flower-visual[data-color="orange"] { color: #ff8c00; }
.flower-visual[data-color="white"] { color: #f8f8f8; text-shadow: 0 0 2px #888; }
.flower-visual[data-color="green"] { color: #228b22; }
.flower-visual[data-color="jade"] { color: #00a86b; }
.flower-visual[data-color="brown"] { color: #8b4513; }
.flower-visual[data-color="black"] { color: #2f2f2f; }
.flower-visual[data-color="peach"] { color: #ffdab9; }

.sprout-visual {
  color: #8fbc8f;
  font-size: 1.5rem;
}

/* Compact Flower Shop Modal */
.flower-shop-modal-compact {
  width: 95%;
  max-width: 1200px;
  max-height: 90vh;
  overflow-y: auto;
  background: #fff9f0;
  border: 3px solid #bfa77a;
  padding: 1.5rem;
}

.flower-shop-modal-compact .close {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 2rem;
  cursor: pointer;
  color: #5a4a3a;
}

.shop-compact-grid {
  display: grid;
  grid-template-columns: 250px 1fr;
  grid-template-rows: auto auto;
  gap: 1rem;
  margin-top: 1rem;
}

.shop-section {
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
}

.shop-section h3 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  font-size: 1.2rem;
  margin-bottom: 0.75rem;
  border-bottom: 1px solid #e8dcc8;
  padding-bottom: 0.5rem;
}

/* Flowers section - left column, spans 2 rows */
.flowers-section {
  grid-column: 1;
  grid-row: 1 / 3;
}

.shop-flower-scroll {
  max-height: 500px;
  overflow-y: auto;
  padding-right: 0.5rem;
}

.shop-flower-scroll::-webkit-scrollbar {
  width: 8px;
}

.shop-flower-scroll::-webkit-scrollbar-track {
  background: #f4f1e4;
  border-radius: 4px;
}

.shop-flower-scroll::-webkit-scrollbar-thumb {
  background: #bfa77a;
  border-radius: 4px;
}

.shop-flower-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: #fff;
  border: 1px solid #e8dcc8;
  border-radius: 6px;
  margin-bottom: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.shop-flower-item:hover {
  background: #f4f1e4;
  border-color: #bfa77a;
  transform: translateX(4px);
}

.shop-flower-item .flower-visual {
  font-size: 1.8rem;
}

.shop-flower-item .flower-label {
  flex: 1;
  font-size: 0.9rem;
  color: #4a3b2c;
}

.shop-flower-item .count {
  background: #bfa77a;
  color: #fff;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: bold;
}

/* Canvas section - top right */
.canvas-section {
  grid-column: 2;
  grid-row: 1;
}

.arrangement-canvas-compact {
  width: 100%;
  height: 300px;
  background: #fefdfb;
  border: 2px dashed #bfa77a;
  border-radius: 8px;
  position: relative;
  overflow: hidden;
}

.arrangement-tools-inline {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.75rem;
  justify-content: center;
}

.arrangement-tools-inline button {
  padding: 0.5rem 1rem;
  background: #e8dcc8;
  border: 1px solid #bfa77a;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'EB Garamond', serif;
  font-size: 1rem;
  color: #4a3b2c;
  transition: all 0.2s ease;
}

.arrangement-tools-inline button:hover {
  background: #bfa77a;
  color: #fff;
}

/* Scores section - bottom left of right column */
.scores-section {
  grid-column: 2;
  grid-row: 2;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.score-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.score-label {
  min-width: 80px;
  font-weight: bold;
  color: #6a5a4a;
  font-size: 0.95rem;
}

.score-bar-compact {
  flex: 1;
  height: 18px;
  background: #f4f1e4;
  border: 1px solid #e8dcc8;
  border-radius: 9px;
  overflow: hidden;
}

.total-value-row {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 2px solid #e8dcc8;
  font-size: 1.3rem;
  color: #5a4a3a;
  text-align: right;
}

/* Presentation section - overlays at bottom */
.presentation-section {
  grid-column: 1 / -1;
  grid-row: 3;
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 1rem;
  align-items: center;
}

.presentation-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.presentation-row label {
  font-weight: bold;
  color: #6a5a4a;
  min-width: 60px;
}

.wrapper-options-inline {
  display: flex;
  gap: 0.5rem;
}

.wrapper-options-inline .wrapper-option {
  padding: 0.4rem 0.8rem;
  background: #fff;
  border: 2px solid #e8dcc8;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'EB Garamond', serif;
  font-size: 0.9rem;
  color: #4a3b2c;
  transition: all 0.2s ease;
}

.wrapper-options-inline .wrapper-option:hover {
  border-color: #bfa77a;
  background: #f4f1e4;
}

.wrapper-options-inline .wrapper-option.selected {
  background: #bfa77a;
  color: #fff;
  border-color: #8b7355;
}

.ribbon-options {
  display: flex;
  gap: 0.5rem;
}

.ribbon-option {
  width: 32px;
  height: 32px;
  border: 2px solid #ddd;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
}

.ribbon-option:hover {
  transform: scale(1.1);
  border-color: #888;
}

.ribbon-option.selected {
  border: 3px solid #5a4a3a;
  box-shadow: 0 0 8px rgba(90,74,58,0.5);
}

.primary-button {
  padding: 0.75rem 2rem;
  background: #8b7355;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 8px rgba(60,40,20,0.2);
}

.primary-button:hover {
  background: #6a5a4a;
  transform: translateY(-2px);
  box-shadow: 0 5px 12px rgba(60,40,20,0.3);
}

/* Canvas flower positioning */
.canvas-flower {
  position: absolute;
  cursor: move;
  transition: transform 0.2s ease;
  user-select: none;
}

.canvas-flower.selected {
  filter: drop-shadow(0 0 8px rgba(139,115,85,0.8));
}

.canvas-flower .flower-visual {
  font-size: 2rem;
  pointer-events: none;
}

/* Seed card updates for botanical names */
.seed-card {
  background: #fff;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 0.75rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.seed-card:hover {
  border-color: #bfa77a;
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(60,40,20,0.15);
}

.seed-card.selected {
  border-color: #8b7355;
  background: #f4f1e4;
  border-width: 3px;
}

.seed-card .flower-visual {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.seed-card .seed-name {
  font-family: 'EB Garamond', serif;
  font-style: italic;
  font-size: 0.85rem;
  color: #6a5a4a;
  margin-bottom: 0.25rem;
  line-height: 1.2;
}

.seed-card .seed-common {
  font-weight: bold;
  color: #4a3b2c;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.seed-card .seed-cost {
  background: #bfa77a;
  color: #fff;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: bold;
  display: inline-block;
  margin-bottom: 0.25rem;
}

.seed-card .seed-info {
  font-size: 0.8rem;
  color: #8b7355;
  margin-top: 0.25rem;
}

/* ===== INVENTORY AND MARKET STYLING ===== */

.inventory-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  background: #fff;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  margin-bottom: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.inventory-item:hover {
  border-color: #bfa77a;
  background: #f4f1e4;
  transform: translateX(4px);
}

.inventory-item .flower-visual {
  font-size: 2rem;
  flex-shrink: 0;
}

.inv-name-box {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.inv-scientific {
  font-size: 0.85rem;
  color: #6a5a4a;
  line-height: 1.2;
}

.inv-common {
  font-weight: bold;
  color: #4a3b2c;
  font-size: 0.95rem;
}

.inv-count {
  background: #bfa77a;
  color: #fff;
  padding: 4px 12px;
  border-radius: 16px;
  font-weight: bold;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.demand-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: #f8f5e9;
  border-radius: 6px;
  margin-bottom: 0.4rem;
  font-size: 0.95rem;
}

.demand-item .flower-visual {
  font-size: 1.5rem;
}

.demand-flower-name {
  flex: 1;
  color: #4a3b2c;
  font-weight: 600;
}

.demand-value {
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 4px;
  background: #e8dcc8;
}

.demand-item.high-demand .demand-value {
  background: #d4f4dd;
  color: #2d7a3e;
}

.demand-item.low-demand .demand-value {
  background: #ffe0e0;
  color: #c94f4f;
}

.bouquet-flower {
  display: inline-block;
  margin: 0.25rem;
  position: relative;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.bouquet-flower:hover {
  transform: scale(1.1);
}

.bouquet-flower .flower-visual {
  font-size: 2.5rem;
}

.upgrade-card {
  background: #fff;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}

.upgrade-card:hover {
  border-color: #bfa77a;
  box-shadow: 0 2px 8px rgba(60,40,20,0.1);
}

.upgrade-name {
  font-weight: bold;
  color: #4a3b2c;
  font-size: 1.05rem;
}

.upgrade-cost {
  color: #8b7355;
  margin-top: 0.25rem;
  font-size: 0.9rem;
}

.upgrade-btn {
  padding: 0.5rem 1.5rem;
  background: #8b7355;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'EB Garamond', serif;
  font-size: 1rem;
  transition: all 0.2s ease;
}

.upgrade-btn:hover:not(:disabled) {
  background: #6a5a4a;
}

.upgrade-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
}

/* ===== VICTORIAN BOTANICAL FONT STYLING ===== */

h1, h2, h3, h4, h5, h6 {
  font-family: 'Playfair Display', 'EB Garamond', serif;
  font-weight: 700;
  letter-spacing: 0.5px;
}

h1 {
  font-weight: 900;
  letter-spacing: 3px;
}

button, .action-btn, .btn {
  font-family: 'Crimson Text', 'EB Garamond', serif;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.hint, em, i {
  font-family: 'EB Garamond', serif;
  font-style: italic;
}

label, .stat-label, .seed-name, .inv-common {
  font-family: 'Crimson Text', serif;
  font-weight: 600;
}

/* Shop footer with return button */
.shop-footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 2px solid #e8dcc8;
  text-align: center;
}

.return-button {
  padding: 0.75rem 2.5rem;
  background: #6a5a4a;
  color: #fff;
  border: 2px solid #5a4a3a;
  border-radius: 8px;
  font-family: 'Crimson Text', serif;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 8px rgba(60,40,20,0.2);
  letter-spacing: 1px;
}

.return-button:hover {
  background: #5a4a3a;
  transform: translateY(-2px);
  box-shadow: 0 5px 12px rgba(60,40,20,0.3);
}

/* Enhanced readability for body text */
p, span, div {
  font-family: 'EB Garamond', serif;
  font-size: 1.05rem;
}

/* Close X button styling */
.close {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  font-size: 2.5rem;
  color: #6a5a4a;
  transition: all 0.2s ease;
}

.close:hover {
  color: #4a3b2c;
  transform: scale(1.1);
}
/* ===== BOTANICAL HERBARIUM STYLING ===== */

.herbarium {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 1rem;
  padding: 1rem 0;
}

.botanical-card {
  background: #faf8f0;
  border: 2px solid #bfa77a;
  border-radius: 8px;
  padding: 0.75rem;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(101,67,33,0.1);
}

.botanical-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 16px rgba(101,67,33,0.2);
  border-color: #a08860;
}

.card-illustration {
  width: 100%;
  height: 120px;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card-illustration svg {
  max-width: 100%;
  max-height: 100%;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
}

.botanical-svg {
  width: 100%;
  height: 100%;
}

.card-info {
  border-top: 1px solid #d4c79f;
  padding-top: 0.5rem;
}

.card-scientific {
  font-family: 'EB Garamond', serif;
  font-size: 0.85rem;
  color: #6a5a4a;
  margin-bottom: 0.15rem;
}

.card-scientific em {
  font-style: italic;
}

.card-common {
  font-family: 'Crimson Text', serif;
  font-size: 0.75rem;
  color: #8b7355;
  font-weight: 600;
}

.herbarium-progress {
  grid-column: 1 / -1;
  text-align: center;
  padding: 0.75rem;
  background: #f0e9d8;
  border-radius: 6px;
  margin-top: 0.5rem;
  font-family: 'EB Garamond', serif;
  color: #6a5a4a;
}
/* ===== BOTANICAL GARDEN VISUALS ===== */

.botanical-plant {
  position: absolute;
  transform: translateX(-50%);
  pointer-events: none;
  z-index: 2;
}

.botanical-plant svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.2));
}

/* ===== VASE ARRANGEMENT STYLING ===== */

.vase-svg {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 180px;
  height: 220px;
  z-index: 1;
  filter: drop-shadow(2px 4px 8px rgba(0,0,0,0.25));
}

.arrangement-canvas-compact {
  position: relative;
  min-height: 320px;
  background: radial-gradient(ellipse at center, rgba(212,199,159,0.1) 0%, transparent 70%);
}

.arrangement-flowers {
  position: relative;
  z-index: 2;
}

/* Large Flower Shop Modal - Full Screen Experience */
.flower-shop-modal-large {
  width: 98%;
  max-width: 1600px;
  height: 90vh;
  max-height: 900px;
  background: #fff9f0;
  border: 3px solid #bfa77a;
  padding: 1.5rem;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.flower-shop-modal-large .close {
  position: absolute;
  top: 15px;
  right: 25px;
  font-size: 2.5rem;
  cursor: pointer;
  color: #5a4a3a;
  z-index: 100;
  transition: all 0.2s;
}

.flower-shop-modal-large .close:hover {
  color: #8b7355;
  transform: scale(1.2);
}

.flower-shop-modal-large h2 {
  margin-bottom: 1rem;
}

.shop-main-layout {
  display: grid;
  grid-template-columns: 280px 1fr 320px;
  gap: 1.5rem;
  flex: 1;
  min-height: 0;
}

/* Left sidebar - flower list */
.shop-sidebar {
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
  overflow-y: auto;
}

.shop-sidebar h3 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  font-size: 1.3rem;
  margin-bottom: 0.75rem;
  border-bottom: 1px solid #e8dcc8;
  padding-bottom: 0.5rem;
}

/* Center - Large arrangement canvas */
.shop-canvas-main {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.arrangement-canvas-large {
  flex: 1;
  background: #fefdfb;
  border: 3px solid #bfa77a;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
  min-height: 500px;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
}

.arrangement-tools {
  display: flex;
  gap: 1rem;
  justify-content: center;
  padding: 0.75rem;
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
}

.tool-btn {
  background: #bfa77a;
  color: #fff;
  border: none;
  padding: 0.6rem 1.5rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'EB Garamond', serif;
  font-size: 1.1rem;
  transition: all 0.2s;
}

.tool-btn:hover {
  background: #a08860;
  transform: translateY(-2px);
}

.tool-btn.warning {
  background: #c9754a;
}

.tool-btn.warning:hover {
  background: #b05a2f;
}

/* Right sidebar - scores and presentation */
.shop-sidebar-right {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  overflow-y: auto;
}

.scores-panel,
.presentation-panel {
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 8px;
  padding: 1rem;
}

.scores-panel h3,
.presentation-panel h3 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  font-size: 1.2rem;
  margin-bottom: 1rem;
  border-bottom: 1px solid #e8dcc8;
  padding-bottom: 0.5rem;
}

.score-row {
  margin-bottom: 1rem;
}

.score-label {
  display: block;
  font-size: 0.95rem;
  color: #6a5a4a;
  margin-bottom: 0.25rem;
}

.score-bar {
  width: 100%;
  height: 20px;
  background: #e8dcc8;
  border-radius: 10px;
  overflow: hidden;
}

.score-fill {
  height: 100%;
  width: 0%;
  transition: width 0.5s ease;
}

.score-fill.aesthetic {
  background: linear-gradient(90deg, #d4a574, #f4d4a6);
}

.score-fill.trend {
  background: linear-gradient(90deg, #8b7355, #bfa77a);
}

.score-fill.harmony {
  background: linear-gradient(90deg, #a08860, #d4c79f);
}

.total-value-display {
  margin-top: 1rem;
  padding: 1rem;
  background: #fff;
  border: 2px solid #bfa77a;
  border-radius: 8px;
  text-align: center;
  font-size: 1.3rem;
  color: #5a4a3a;
}

.presentation-option {
  margin-bottom: 1.5rem;
}

.presentation-option label {
  display: block;
  font-weight: bold;
  color: #5a4a3a;
  margin-bottom: 0.5rem;
}

.wrapper-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
}

.primary-button.large {
  width: 100%;
  padding: 1rem;
  font-size: 1.2rem;
  margin-top: 1rem;
}

/* Canvas flower items - larger and more interactive */
.canvas-flower {
  position: absolute;
  cursor: move;
  transition: transform 0.1s ease;
  z-index: 1;
}

.canvas-flower.selected {
  z-index: 10;
  filter: drop-shadow(0 0 10px rgba(191, 167, 122, 0.8));
}

.canvas-flower:hover {
  filter: drop-shadow(0 0 8px rgba(191, 167, 122, 0.5));
}

.canvas-flower svg {
  width: 80px;
  height: 80px;
  pointer-events: none;
}


/* Vase background in arrangement canvas */
.vase-background {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  pointer-events: none;
  z-index: 0;
}

.arrangement-flowers {
  position: relative;
  z-index: 1;
  width: 100%;
  height: 100%;
}

/* Specimen Notebook Modal */
.notebook-modal {
  width: 95%;
  max-width: 1400px;
  max-height: 90vh;
  background: #fff9f0;
  border: 3px solid #bfa77a;
  padding: 2rem;
  overflow-y: auto;
}

.specimen-list {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin: 1.5rem 0;
}

.specimen-entry {
  background: #f8f5e9;
  border: 2px solid #e8dcc8;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(60,40,20,0.08);
}

.specimen-header {
  display: grid;
  grid-template-columns: 150px 1fr;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 2px solid #e8dcc8;
}

.specimen-illustration {
  width: 150px;
  height: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border: 2px solid #bfa77a;
  border-radius: 8px;
}

.specimen-illustration svg {
  width: 120px;
  height: 120px;
}

.specimen-title h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.8rem;
  color: #5a4a3a;
  margin-bottom: 0.5rem;
}

.scientific-name {
  font-size: 1.2rem;
  color: #6a5a4a;
  margin-bottom: 0.25rem;
}

.flower-family {
  font-size: 0.95rem;
  color: #8b7355;
  font-style: italic;
}

.specimen-body {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.specimen-section h4 {
  font-family: 'Playfair Display', serif;
  color: #5a4a3a;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  border-bottom: 1px solid #e8dcc8;
  padding-bottom: 0.25rem;
}

.specimen-section p {
  line-height: 1.7;
  color: #4a3b2c;
  text-align: justify;
}

.specimen-progress {
  text-align: center;
  padding: 1.5rem;
  background: #bfa77a;
  color: white;
  border-radius: 8px;
  margin-top: 1rem;
  font-size: 1.1rem;
}

.notebook-footer {
  text-align: center;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 2px solid #e8dcc8;
}/* ===== VICTORIAN CONTROL PANELS ===== */
.victorian-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f5efe0 0%, #e8dcc8 100%);
  border: 3px double #bfa77a;
  border-radius: 12px;
  box-shadow: inset 0 2px 4px rgba(139,115,85,0.15);
}

.control-panel {
  display: flex;
  gap: 1.5rem;
  align-items: center;
}

.control-knob {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.control-knob:hover {
  transform: translateY(-3px);
}

.control-knob:active .knob-dial {
  transform: scale(0.95);
}

.knob-dial {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #e8dcc8, #bfa77a);
  border: 4px solid #8b7355;
  box-shadow: 
    0 4px 8px rgba(0,0,0,0.25),
    inset 0 -2px 4px rgba(0,0,0,0.2),
    inset 0 2px 4px rgba(255,255,255,0.3);
  position: relative;
  transition: all 0.2s;
}

.knob-dial::before {
  content: '';
  position: absolute;
  width: 6px;
  height: 20px;
  background: #5a4a3a;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.knob-dial.straighten::before {
  height: 26px;
  top: 5px;
  background: linear-gradient(to bottom, #5a4a3a, #8b7355);
}

.knob-dial.size-up::after {
  content: '+';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 28px;
  font-weight: bold;
  color: #5a4a3a;
}

.knob-dial.size-down::after {
  content: 'âˆ’';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  font-weight: bold;
  color: #5a4a3a;
}

.knob-label {
  font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
  font-size: 14px;
  color: #5a4a3a;
  text-align: center;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
}

/* Rotation Control Group */
.rotation-control-group {
  display: flex;
  align-items: center;
  gap: 2rem;
  padding: 0 1rem;
}

.sensitivity-dial-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.4rem;
}

.sensitivity-dial {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #d4c4a8, #bfa77a);
  border: 5px solid #8b7355;
  box-shadow: 
    0 6px 12px rgba(0,0,0,0.3),
    inset 0 -3px 6px rgba(0,0,0,0.25),
    inset 0 3px 6px rgba(255,255,255,0.4);
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
}

.sensitivity-dial:hover {
  transform: scale(1.05);
}

.dial-indicator {
  position: absolute;
  width: 4px;
  height: 30px;
  background: linear-gradient(to bottom, #8b4557, #5a4a3a);
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 2px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.4);
  transform-origin: 50% 130%;
  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.dial-notch {
  position: absolute;
  width: 8px;
  height: 3px;
  background: #5a4a3a;
  border-radius: 2px;
  top: 50%;
  left: 50%;
}

.dial-notch.n1 { transform: translate(-50%, -50%) rotate(0deg) translateY(-35px); }
.dial-notch.n2 { transform: translate(-50%, -50%) rotate(45deg) translateY(-35px); }
.dial-notch.n3 { transform: translate(-50%, -50%) rotate(90deg) translateY(-35px); }
.dial-notch.n4 { transform: translate(-50%, -50%) rotate(135deg) translateY(-35px); }

.dial-label {
  font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
  font-size: 13px;
  color: #5a4a3a;
  font-weight: 600;
}

.dial-value {
  font-family: 'EB Garamond', serif;
  font-size: 16px;
  color: #8b4557;
  font-weight: bold;
  background: rgba(255,255,255,0.6);
  padding: 2px 8px;
  border-radius: 4px;
  border: 1px solid #bfa77a;
}

.clear-knob .knob-dial {
  background: radial-gradient(circle at 30% 30%, #f4d4d4, #d49999);
  border-color: #8b4557;
}

.clear-knob .knob-dial::before {
  content: 'Ã—';
  position: static;
  font-size: 36px;
  font-weight: bold;
  color: #5a4a3a;
  line-height: 60px;
  text-align: center;
  width: 100%;
  height: 100%;
  display: block;
  transform: none;
  background: none;
  border-radius: 0;
  box-shadow: none;
}

/* ===== VICTORIAN PLOT STYLING ===== */
.plot {
  width: 80px;
  height: 80px;
  border: 3px solid #8b7355;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 32px;
  transition: all 0.3s;
  position: relative;
  background-image: 
    repeating-linear-gradient(90deg, #c4a77a 0px, #c4a77a 2px, transparent 2px, transparent 4px),
    repeating-linear-gradient(0deg, #c4a77a 0px, #c4a77a 2px, transparent 2px, transparent 4px);
  background-size: 100% 100%;
  background-position: center;
  box-shadow: 
    inset 0 2px 4px rgba(139,115,85,0.3),
    0 2px 4px rgba(0,0,0,0.2);
}

.plot::before {
  content: '';
  position: absolute;
  inset: 4px;
  background: 
    radial-gradient(ellipse at center, rgba(101,67,33,0.4) 0%, rgba(101,67,33,0.2) 40%, transparent 70%),
    linear-gradient(135deg, #a0826d 0%, #8b7355 50%, #6d5d4f 100%);
  border-radius: 4px;
  pointer-events: none;
}

.plot::after {
  content: '';
  position: absolute;
  inset: 6px;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(0,0,0,0.1) 1px, transparent 1px),
    radial-gradient(circle at 60% 70%, rgba(0,0,0,0.08) 1px, transparent 1px),
    radial-gradient(circle at 80% 20%, rgba(0,0,0,0.12) 1px, transparent 1px),
    radial-gradient(circle at 40% 80%, rgba(0,0,0,0.09) 1px, transparent 1px);
  background-size: 100% 100%;
  pointer-events: none;
}

.plot:hover {
  transform: translateY(-2px);
  box-shadow: 
    inset 0 2px 4px rgba(139,115,85,0.3),
    0 4px 8px rgba(0,0,0,0.25);
  border-color: #bfa77a;
}

.plot.ready {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border-color: #4a5d3a;
  animation: plotGlow 2s ease-in-out infinite;
}

.plot.ready::before {
  background: radial-gradient(ellipse at center, rgba(74,93,58,0.2) 0%, transparent 70%);
}

@keyframes plotGlow {
  0%, 100% { box-shadow: inset 0 2px 4px rgba(74,93,58,0.3), 0 2px 8px rgba(139,195,74,0.4); }
  50% { box-shadow: inset 0 2px 4px rgba(74,93,58,0.3), 0 2px 12px rgba(139,195,74,0.6); }
}

.flower-visual {
  position: relative;
  z-index: 2;
  transition: transform 0.3s;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  font-size: 36px;
}

/* ===== PAGE VIEW STYLING (for full-page views like flower shop) ===== */
.page-view {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  background: #fff9f0;
  z-index: 1000;
  overflow-y: auto;
}

.page-header {
  background: linear-gradient(135deg, #f5efe0 0%, #e8dcc8 100%);
  border-bottom: 3px solid #bfa77a;
  padding: 1.5rem 2rem;
  display: flex;
  align-items: center;
  gap: 2rem;
  position: sticky;
  top: 0;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.page-header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 2.5rem;
  color: #5a4a3a;
  margin: 0;
  flex: 1;
  text-align: center;
}

.flower-shop-page-content {
  padding: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

/* Enhanced flower visual contrast */
.flower-visual {
  position: relative;
  z-index: 2;
  transition: transform 0.3s;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4)) brightness(1.3) saturate(1.4);
  font-size: 42px;
  text-shadow: 
    0 0 10px rgba(255,255,255,0.8),
    0 0 20px rgba(255,255,255,0.5),
    2px 2px 4px rgba(0,0,0,0.5);
}

.plot .flower-visual[data-color="yellow"],
.plot .flower-visual[data-color="orange"] {
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4)) brightness(1.5) saturate(1.6);
  text-shadow: 
    0 0 12px rgba(255,255,200,0.9),
    0 0 20px rgba(255,255,150,0.6),
    2px 2px 4px rgba(0,0,0,0.6);
}

.plot .flower-visual[data-color="white"] {
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.5)) brightness(1.8);
  text-shadow: 
    0 0 15px rgba(255,255,255,1),
    0 0 25px rgba(255,255,255,0.8),
    2px 2px 4px rgba(0,0,0,0.7);
}

.plot .flower-visual[data-color="pink"],
.plot .flower-visual[data-color="red"] {
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4)) brightness(1.4) saturate(1.5);
  text-shadow: 
    0 0 10px rgba(255,200,220,0.8),
    0 0 20px rgba(255,150,180,0.5),
    2px 2px 4px rgba(0,0,0,0.6);
}
/* ===== ENHANCED GARDEN VIEW VISUALS ===== */

.visual-garden {
  position: relative;
  width: 100%;
  height: 500px;
  background: 
    radial-gradient(ellipse at 50% 100%, rgba(139,115,85,0.15) 0%, transparent 50%),
    linear-gradient(to bottom, #e8f4f8 0%, #f4f1e4 30%, #e8dcc8 100%);
  border: 3px solid #8b7355;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 
    inset 0 0 30px rgba(139,115,85,0.1),
    0 4px 12px rgba(0,0,0,0.15);
}

.visual-garden::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.4) 0%, transparent 15%),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.3) 0%, transparent 18%),
    radial-gradient(circle at 50% 80%, rgba(139,115,85,0.08) 0%, transparent 25%),
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(139,115,85,0.02) 2px, rgba(139,115,85,0.02) 4px);
  pointer-events: none;
}

/* Enhanced sky with atmospheric perspective */
.garden-sky {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 20%;
  background: linear-gradient(to bottom, 
    rgba(232,244,248,0.6) 0%, 
    rgba(244,241,228,0.3) 50%,
    transparent 100%);
  z-index: 1;
}

.sun {
  position: absolute;
  top: 15px;
  right: 35px;
  width: 45px;
  height: 45px;
  border: none;
  border-radius: 50%;
  background: radial-gradient(circle, 
    rgba(255,243,196,0.8) 0%, 
    rgba(255,235,150,0.5) 40%, 
    transparent 70%);
  box-shadow: 0 0 20px rgba(255,235,150,0.4);
  animation: sunGlow 4s ease-in-out infinite;
}

.sun::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: radial-gradient(circle, 
    transparent 60%, 
    rgba(255,243,196,0.2) 70%, 
    transparent 80%);
}

@keyframes sunGlow {
  0%, 100% { opacity: 0.9; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
}

.cloud {
  position: absolute;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(139,115,85,0.1);
  border-radius: 30px;
  backdrop-filter: blur(1px);
  animation: float 25s ease-in-out infinite;
}

/* Enhanced soil rows with texture */
.soil-row {
  position: relative;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}

.soil-row::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 15% 30%, rgba(160,130,109,0.3) 1px, transparent 1px),
    radial-gradient(circle at 45% 60%, rgba(139,115,85,0.25) 1.5px, transparent 1.5px),
    radial-gradient(circle at 75% 25%, rgba(107,83,69,0.3) 1px, transparent 1px),
    radial-gradient(circle at 85% 70%, rgba(155,131,101,0.2) 1px, transparent 1px),
    repeating-linear-gradient(90deg, transparent, transparent 25px, rgba(139,115,85,0.08) 25px, rgba(139,115,85,0.08) 26px);
  background-size: 100% 100%;
  pointer-events: none;
}

.soil-row::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(to right, 
    transparent 0%, 
    rgba(74,58,42,0.3) 20%, 
    rgba(74,58,42,0.3) 80%, 
    transparent 100%);
}

/* Enhanced visual plants */
.visual-plant {
  position: absolute;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.25)) contrast(1.05) saturate(1.15);
  transform: translateX(-50%);
  z-index: 2;
}

.visual-plant:hover {
  transform: translateX(-50%) scale(1.12) translateY(-5px);
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3)) contrast(1.1) saturate(1.25) brightness(1.05);
  z-index: 10;
}

/* Mature flowers have enhanced visuals */
.visual-plant.mature-flower {
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)) contrast(1.08) saturate(1.3) brightness(1.05);
}

.visual-plant.mature-flower:hover {
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.35)) contrast(1.12) saturate(1.4) brightness(1.1);
}

/* Swaying animation for mature flowers */
@keyframes sway {
  0%, 100% { 
    transform: translateX(-50%) rotate(-2deg);
  }
  50% { 
    transform: translateX(-50%) rotate(2deg);
  }
}

/* Growing animation for seedlings */
@keyframes grow {
  0% { 
    transform: translateX(-50%) scale(0.5) translateY(10px);
    opacity: 0;
  }
  100% { 
    transform: translateX(-50%) scale(1) translateY(0);
    opacity: 1;
  }
}

/* Enhanced decorative elements */
.butterfly, .bee {
  position: absolute;
  font-size: 1.3rem;
  opacity: 0.5;
  filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
  animation: fly 18s ease-in-out infinite;
}

@keyframes fly {
  0%, 100% { 
    transform: translate(0, 0) rotate(0deg);
    opacity: 0.5;
  }
  25% { 
    transform: translate(30px, -20px) rotate(5deg);
    opacity: 0.7;
  }
  50% { 
    transform: translate(50px, 10px) rotate(-3deg);
    opacity: 0.6;
  }
  75% { 
    transform: translate(20px, -10px) rotate(2deg);
    opacity: 0.7;
  }
}

/* Fix arrangement canvas and vase positioning */
.arrangement-canvas-compact {
  width: 100%;
  height: 400px;
  background: linear-gradient(to bottom, #fefdfb 0%, #f8f5e9 100%);
  border: 2px dashed #bfa77a;
  border-radius: 8px;
  position: relative;
  overflow: visible;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
}

/* Victorian table surface */
.arrangement-table {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 140px;
  background: linear-gradient(to bottom, 
    rgba(139,115,85,0.1) 0%,
    rgba(139,115,85,0.15) 10%,
    rgba(139,115,85,0.2) 100%);
  pointer-events: none;
  z-index: 0;
}

.table-edge {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(to right,
    transparent 0%,
    rgba(139,115,85,0.4) 5%,
    rgba(139,115,85,0.5) 50%,
    rgba(139,115,85,0.4) 95%,
    transparent 100%);
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

/* Vase positioning on table */
.vase-svg {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 140px;
  height: 180px;
  z-index: 1;
  filter: drop-shadow(3px 5px 10px rgba(0,0,0,0.3));
  pointer-events: none;
}

/* Arrangement flowers go in front of vase */
.arrangement-flowers {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.canvas-flower {
  pointer-events: all;
}

/* Victorian controls - fix overflow and spacing */
.victorian-controls {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-top: 1.5rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f5efe0 0%, #e8dcc8 100%);
  border: 3px double #bfa77a;
  border-radius: 12px;
  box-shadow: inset 0 2px 4px rgba(139,115,85,0.15);
  overflow: visible;
  min-height: 130px;
}

.control-panel {
  display: flex;
  gap: 1.2rem;
  align-items: flex-start;
  flex-wrap: nowrap;
}

.control-knob {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.6rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  padding-bottom: 0.3rem;
  min-width: 70px;
}

.knob-label {
  font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
  font-size: 13px;
  color: #5a4a3a;
  text-align: center;
  font-weight: 600;
  letter-spacing: 0.3px;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
  white-space: nowrap;
  line-height: 1.2;
  max-width: 80px;
}

.rotation-control-group {
  display: flex;
  align-items: flex-start;
  gap: 1.5rem;
  padding: 0 0.5rem;
}

.sensitivity-dial-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding-bottom: 0.3rem;
}

.dial-label {
  font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
  font-size: 12px;
  color: #5a4a3a;
  font-weight: 600;
  white-space: nowrap;
}

.dial-value {
  font-family: 'EB Garamond', serif;
  font-size: 15px;
  color: #8b4557;
  font-weight: bold;
  background: rgba(255,255,255,0.6);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid #bfa77a;
  white-space: nowrap;
}

/* ===== VICTORIAN 1800s FONT STYLING ===== */
* {
  font-family: 'Crimson Text', 'Libre Baskerville', 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
}

body {
  font-family: 'Crimson Text', 'Libre Baskerville', serif;
  font-size: 16px;
  letter-spacing: 0.3px;
}

h1, h2, h3 {
  font-family: 'Pinyon Script', 'Brush Script MT', cursive;
  font-weight: normal;
  letter-spacing: 1px;
}

h1 {
  font-size: 3.5rem;
  font-weight: 400;
}

h2 {
  font-size: 2.5rem;
}

h3 {
  font-size: 1.8rem;
}

.action-btn, button {
  font-family: 'Crimson Text', serif;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* ===== ENHANCED VASE STYLING ===== */
.vase-svg {
  position: absolute;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  height: 200px;
  z-index: 1;
  filter: drop-shadow(2px 4px 12px rgba(100,140,180,0.4));
  pointer-events: none;
}

/* ===== REDESIGNED VICTORIAN CONTROL KNOBS ===== */
.victorian-controls {
  display: flex;
  justify-content: space-around;
  align-items: flex-start;
  margin-top: 1.5rem;
  padding: 2rem 1.5rem;
  background: 
    linear-gradient(135deg, #f5efe0 0%, #ebe4d1 100%);
  border: 4px ridge #bfa77a;
  border-radius: 16px;
  box-shadow: 
    inset 0 2px 8px rgba(139,115,85,0.2),
    0 4px 12px rgba(0,0,0,0.15);
  overflow: visible;
  min-height: 140px;
}

.control-panel {
  display: flex;
  gap: 1.8rem;
  align-items: flex-start;
  flex-wrap: nowrap;
}

.control-knob {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.7rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  padding: 0.5rem;
  border-radius: 8px;
  min-width: 75px;
}

.control-knob:hover {
  transform: translateY(-3px);
  background: rgba(255,255,255,0.3);
}

.control-knob:active {
  transform: translateY(-1px);
}

.knob-dial {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: 
    radial-gradient(circle at 35% 35%, #e8dcc8, #c4b49a 60%, #8b7355);
  border: 5px solid #5a4a3a;
  box-shadow: 
    0 6px 12px rgba(0,0,0,0.35),
    inset 0 -3px 8px rgba(0,0,0,0.3),
    inset 0 3px 8px rgba(255,255,255,0.4),
    inset 0 0 20px rgba(139,115,85,0.2);
  position: relative;
  transition: all 0.2s;
}

.knob-dial::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 50px;
  height: 50px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background: radial-gradient(circle at 40% 40%, rgba(255,255,255,0.3), transparent 60%);
  pointer-events: none;
}

.knob-dial::before {
  content: '';
  position: absolute;
  width: 8px;
  height: 24px;
  background: linear-gradient(to bottom, #3a2a1a, #5a4a3a);
  top: 6px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 4px;
  box-shadow: 
    0 2px 4px rgba(0,0,0,0.4),
    inset 0 1px 1px rgba(255,255,255,0.2);
}

.knob-dial.straighten::before {
  height: 30px;
  top: 3px;
  width: 6px;
  background: linear-gradient(to bottom, #4a3a2a, #6a5a4a);
  border-radius: 3px;
}

.knob-dial.size-up::before,
.knob-dial.size-down::before {
  display: none;
}

.knob-dial.size-up::after {
  content: '+';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 36px;
  font-weight: bold;
  color: #3a2a1a;
  text-shadow: 0 1px 2px rgba(255,255,255,0.5);
  z-index: 2;
}

.knob-dial.size-down::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 40px;
  font-weight: bold;
  color: #3a2a1a;
  text-shadow: 0 1px 2px rgba(255,255,255,0.5);
  z-index: 2;
}

.knob-label {
  font-family: 'Pinyon Script', 'Brush Script MT', cursive;
  font-size: 16px;
  color: #3a2a1a;
  text-align: center;
  font-weight: normal;
  letter-spacing: 0.5px;
  text-shadow: 1px 1px 3px rgba(255,255,255,0.9);
  white-space: nowrap;
  line-height: 1.3;
}

.rotation-control-group {
  display: flex;
  align-items: flex-start;
  gap: 2rem;
  padding: 0 1rem;
}

.sensitivity-dial-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.6rem;
  padding: 0.5rem;
}

.sensitivity-dial {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  background: 
    radial-gradient(circle at 38% 38%, #d4c4a8, #bfa77a 65%, #8b7355);
  border: 6px solid #5a4a3a;
  box-shadow: 
    0 8px 16px rgba(0,0,0,0.4),
    inset 0 -4px 10px rgba(0,0,0,0.35),
    inset 0 4px 10px rgba(255,255,255,0.4);
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
}

.sensitivity-dial:hover {
  transform: scale(1.08);
  box-shadow: 
    0 10px 20px rgba(0,0,0,0.45),
    inset 0 -4px 10px rgba(0,0,0,0.35),
    inset 0 4px 10px rgba(255,255,255,0.4);
}

.dial-indicator {
  position: absolute;
  width: 5px;
  height: 34px;
  background: linear-gradient(to bottom, #8b4557, #5a3a3a);
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 3px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  transform-origin: 50% 140%;
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.dial-notch {
  position: absolute;
  width: 10px;
  height: 4px;
  background: #3a2a1a;
  border-radius: 2px;
  top: 50%;
  left: 50%;
  box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.dial-label {
  font-family: 'Pinyon Script', cursive;
  font-size: 15px;
  color: #3a2a1a;
  font-weight: normal;
  white-space: nowrap;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
}

.dial-value {
  font-family: 'Crimson Text', serif;
  font-size: 17px;
  color: #8b4557;
  font-weight: bold;
  background: rgba(255,255,255,0.7);
  padding: 3px 10px;
  border-radius: 6px;
  border: 2px solid #bfa77a;
  white-space: nowrap;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.clear-knob .knob-dial {
  background: radial-gradient(circle at 35% 35%, #f4d4d4, #d49999 60%, #8b4557);
  border-color: #5a3a3a;
}

.clear-knob .knob-dial::before {
  content: '';
  position: static;
  font-size: 48px;
  font-weight: bold;
  color: #3a2a1a;
  line-height: 70px;
  text-align: center;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  transform: none;
  background: none;
  border-radius: 0;
  box-shadow: none;
  text-shadow: 0 2px 3px rgba(255,255,255,0.5);
}

/* ===== ENHANCED FLOWER SHOP FLOWERS ===== */
.shop-flower-item {
  position: relative;
  padding: 1rem;
  background: 
    linear-gradient(135deg, #fefdfb 0%, #f8f5e9 100%);
  border: 2px solid #e8dcc8;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 2px 8px rgba(0,0,0,0.1),
    inset 0 1px 3px rgba(255,255,255,0.8);
}

.shop-flower-item:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 
    0 6px 16px rgba(0,0,0,0.2),
    inset 0 1px 3px rgba(255,255,255,0.9);
  border-color: #bfa77a;
  background: linear-gradient(135deg, #ffffff 0%, #fefdfb 100%);
}

.shop-flower-item svg {
  filter: 
    drop-shadow(0 3px 6px rgba(0,0,0,0.2))
    contrast(1.1)
    saturate(1.3)
    brightness(1.05);
  transition: filter 0.3s;
}

.shop-flower-item:hover svg {
  filter: 
    drop-shadow(0 4px 10px rgba(0,0,0,0.25))
    contrast(1.15)
    saturate(1.4)
    brightness(1.1);
}

/* Canvas flowers */
.canvas-flower {
  position: absolute;
  cursor: move;
  transition: all 0.2s;
  filter: 
    drop-shadow(0 4px 8px rgba(0,0,0,0.25))
    contrast(1.1)
    saturate(1.25);
}

.canvas-flower:hover {
  filter: 
    drop-shadow(0 6px 12px rgba(0,0,0,0.3))
    contrast(1.15)
    saturate(1.35)
    brightness(1.05);
  z-index: 100;
}

.canvas-flower.selected {
  filter: 
    drop-shadow(0 0 12px rgba(191,167,122,0.8))
    drop-shadow(0 6px 12px rgba(0,0,0,0.35))
    contrast(1.15)
    saturate(1.4)
    brightness(1.1);
  z-index: 101;
}

.canvas-flower svg {
  width: 100%;
  height: 100%;
  pointer-events: none;
}

/* Smooth dragging cursor styles */
.canvas-flower {
  cursor: grab;
  user-select: none;
  transition: none !important;
}

.canvas-flower:active {
  cursor: grabbing;
}

.canvas-flower:hover {
  transition: filter 0.2s;
}

/* Smooth movement without jitter */
.arrangement-flowers {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.canvas-flower {
  pointer-events: all;
  will-change: transform;
}

</style>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌸</text></svg>">
</head>
<body>    <!-- Always visible money counter -->
    <div id="money-corner" class="money-corner">
        <span class="money-icon">💰</span>
        <span id="money-display">$100</span>
    </div>
        <div class="game-container">
        <header>
            <h1>My Flower Garden</h1>
            <p style="font-style: italic; color: #8b7355; margin-bottom: 10px; font-family: 'EB Garamond', serif;">~ A Botanical Journal, Est. 1847 ~</p>
            <div class="stats-bar">
                <div class="stat">
                    <span class="stat-label">Treasury:</span>
                    <span id="money">$100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Week:</span>
                    <span id="week">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Garden Plot:</span>
                    <span id="garden-size">4×4</span>
                </div>
            </div>
        </header>

        <main>
            <div class="game-panels">
                <!-- Left Panel: Garden Grid -->
                <section class="panel garden-panel">
                    <h2>The Garden</h2>
                    <div class="garden-view-toggle">
                        <button id="grid-view-btn" class="view-btn active">Plot View</button>
                        <button id="visual-view-btn" class="view-btn">Garden View</button>
                    </div>
                    
                    <!-- Grid View -->
                    <div id="grid-view" class="garden-view">
                        <div id="garden-grid" class="garden-grid"></div>
                    </div>
                    
                    <!-- Visual Garden View -->
                    <div id="visual-view" class="garden-view hidden">
                        <div class="visual-garden">
                            <div class="garden-sky">
                                <div class="sun"></div>
                                <div class="cloud cloud-1"></div>
                                <div class="cloud cloud-2"></div>
                            </div>
                            <div class="garden-scene">
                                <div class="garden-back-row"></div>
                                <div class="garden-mid-row"></div>
                                <div class="garden-front-row"></div>
                                <div id="visual-plants" class="visual-plants"></div>
                            </div>
                            <div class="garden-ground">
                                <div class="fence"></div>
                                <div class="path"></div>
                            </div>
                            <div class="garden-decorations">
                                <div class="butterfly butterfly-1">🦋</div>
                                <div class="butterfly butterfly-2">🦋</div>
                                <div class="bee">🐝</div>
                            </div>
                        </div>
                        <div class="visual-garden-info">
                            <p class="hint">Click on plants to water or harvest them</p>
                        </div>
                    </div>
                    
                    <div class="garden-actions">
                        <button id="water-all-btn" class="action-btn">Water All ($5)</button>
                        <button id="next-day-btn" class="action-btn primary">Advance Day</button>
                    </div>
                </section>

                <!-- Center Panel: Seed Shop -->
                <section class="panel shop-panel">
                    <h2>Seed Catalogue</h2>
                    <p class="hint">Select a seed, then choose an empty plot to sow</p>
                    <div id="seed-shop" class="seed-shop"></div>
                    
                    <h2>Harvested Specimens</h2>
                    <div id="inventory" class="inventory"></div>
                    
                    <h2>Botanical Herbarium</h2>
                    <p class="hint">Illustrations collected from cultivated specimens</p>
                    <div id="herbarium" class="herbarium"></div>
                            <div id="current-bouquet" class="current-bouquet"></div>
                            <div class="bouquet-value">
                                <span>Estimated Value: </span><span id="bouquet-value">$0</span>
                            </div>
                            <button id="create-bouquet-btn" class="action-btn">Complete Arrangement</button>
                        </div>
                    </div>

                    <h2>Weekly Market</h2>
                    <div class="market-section">
                        <div class="market-demand">
                            <h3>Current Demand:</h3>
                            <div id="market-demand"></div>
                        </div>
                        <div id="bouquets-for-sale" class="bouquets-for-sale"></div>
                        <button id="end-week-btn" class="action-btn warning">Conclude Week & Sell</button>
                    </div>
                </section>
            </div>
        </main>

<!-- Flower Shop Page (full page view) -->
        <div id="flower-shop-page" class="page-view hidden">
            <div class="page-header">
                <button id="close-flower-shop" class="return-button">← Return to Garden</button>
                <h1>The Arrangement Studio</h1>
            </div>
            <div class="flower-shop-page-content">
                <div class="shop-main-layout">
                    <!-- Row 1: Flowers + Canvas -->
                    <div class="shop-section flowers-section">
                        <h3>Available Specimens</h3>
                        <div id="shop-available-flowers" class="shop-flower-scroll"></div>
                    </div>
                    
                    <div class="shop-section canvas-section">
                        <div id="arrangement-canvas" class="arrangement-canvas-compact">
                            <!-- Victorian table surface -->
                            <div class="arrangement-table">
                                <div class="table-edge"></div>
                            </div>
                            <!-- Elegant Victorian Crystal Vase -->
                            <svg class="vase-svg" viewBox="0 0 120 160" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="crystalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#f0f8ff;stop-opacity:0.9" />
                                        <stop offset="40%" style="stop-color:#e6f2ff;stop-opacity:0.85" />
                                        <stop offset="100%" style="stop-color:#d4e8f7;stop-opacity:0.9" />
                                    </linearGradient>
                                    <linearGradient id="crystalShine" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:rgba(255,255,255,0)" />
                                        <stop offset="40%" style="stop-color:rgba(255,255,255,0.8)" />
                                        <stop offset="60%" style="stop-color:rgba(255,255,255,0.8)" />
                                        <stop offset="100%" style="stop-color:rgba(255,255,255,0)" />
                                    </linearGradient>
                                    <radialGradient id="crystalReflection">
                                        <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.6" />
                                        <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0" />
                                    </radialGradient>
                                    <filter id="glassBlur">
                                        <feGaussianBlur in="SourceGraphic" stdDeviation="0.5" />
                                    </filter>
                                </defs>
                                
                                <!-- Main crystal body with elegant curves -->
                                <path d="M 40 35 Q 35 50 38 70 Q 40 90 42 110 L 42 140 Q 42 148 50 150 L 70 150 Q 78 148 78 140 L 78 110 Q 80 90 82 70 Q 85 50 80 35 Q 77 25 60 23 Q 43 25 40 35 Z" 
                                      fill="url(#crystalGrad)" 
                                      stroke="#b0c4de" 
                                      stroke-width="1.5"
                                      opacity="0.95"/>
                                
                                <!-- Rim with cut glass effect -->
                                <ellipse cx="60" cy="33" rx="21" ry="8" fill="#e6f2ff" stroke="#b0c4de" stroke-width="1.5" opacity="0.9"/>
                                <ellipse cx="60" cy="33" rx="18" ry="6" fill="url(#crystalReflection)"/>
                                <path d="M 39 33 Q 60 31 81 33" stroke="#ffffff" stroke-width="1" fill="none" opacity="0.5"/>
                                
                                <!-- Base with pedestal -->
                                <ellipse cx="60" cy="150" rx="22" ry="6" fill="#d4e8f7" stroke="#b0c4de" stroke-width="1.5"/>
                                <ellipse cx="60" cy="150" rx="18" ry="4" fill="url(#crystalReflection)"/>
                                
                                <!-- Crystal facets for sparkle -->
                                <path d="M 45 60 L 47 80 L 45 100" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.4"/>
                                <path d="M 75 60 L 73 80 L 75 100" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.4"/>
                                
                                <!-- Main highlight shine -->
                                <ellipse cx="47" cy="75" rx="10" ry="50" fill="url(#crystalShine)" opacity="0.7"/>
                                
                                <!-- Cut glass decorative band -->
                                <g opacity="0.5">
                                    <line x1="40" y1="95" x2="80" y2="95" stroke="#b0c4de" stroke-width="0.5"/>
                                    <line x1="42" y1="100" x2="78" y2="100" stroke="#b0c4de" stroke-width="0.5"/>
                                    <circle cx="50" cy="97.5" r="2" fill="#ffffff" opacity="0.3"/>
                                    <circle cx="60" cy="97.5" r="2" fill="#ffffff" opacity="0.3"/>
                                    <circle cx="70" cy="97.5" r="2" fill="#ffffff" opacity="0.3"/>
                                </g>
                                
                                <!-- Bottom reflection -->
                                <ellipse cx="60" cy="135" rx="15" ry="8" fill="url(#crystalReflection)" opacity="0.3"/>
                            </svg>
                            <div id="arrangement-flowers" class="arrangement-flowers"></div>
                        </div>
                        <div class="victorian-controls">
                            <div class="control-panel left-panel">
                                <div class="control-knob" id="copy-flower-btn" title="Duplicate Specimen">
                                    <div class="knob-dial"></div>
                                    <span class="knob-label">Copy</span>
                                </div>
                                <div class="control-knob" id="set-straight-btn" title="Align Vertical">
                                    <div class="knob-dial straighten"></div>
                                    <span class="knob-label">Straighten</span>
                                </div>
                            </div>
                            
                            <div class="control-panel center-panel">
                                <div class="rotation-control-group">
                                    <div class="control-knob rotate-left" id="rotate-counter-btn" title="Turn Counter-Clockwise">
                                        <div class="knob-dial"></div>
                                        <span class="knob-label">Turn ↶</span>
                                    </div>
                                    <div class="sensitivity-dial-container">
                                        <div class="sensitivity-dial" id="sensitivity-dial">
                                            <div class="dial-indicator"></div>
                                            <div class="dial-notch n1"></div>
                                            <div class="dial-notch n2"></div>
                                            <div class="dial-notch n3"></div>
                                            <div class="dial-notch n4"></div>
                                        </div>
                                        <span class="dial-label">Sensitivity</span>
                                        <span class="dial-value" id="sensitivity-value">3°</span>
                                    </div>
                                    <div class="control-knob rotate-right" id="rotate-clockwise-btn" title="Turn Clockwise">
                                        <div class="knob-dial"></div>
                                        <span class="knob-label">Turn ↷</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="control-panel right-panel">
                                <div class="control-knob" id="size-up" title="Enlarge">
                                    <div class="knob-dial size-up"></div>
                                    <span class="knob-label">Larger</span>
                                </div>
                                <div class="control-knob" id="size-down" title="Reduce">
                                    <div class="knob-dial size-down"></div>
                                    <span class="knob-label">Smaller</span>
                                </div>
                                <div class="control-knob clear-knob" id="clear-arrangement" title="Clear Canvas">
                                    <div class="knob-dial"></div>
                                    <span class="knob-label">Clear All</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 2: Scores + Presentation -->
                    <div class="shop-section scores-section">
                        <div class="score-row">
                            <span class="score-label">Aesthetic:</span>
                            <div class="score-bar-compact"><div id="aesthetic-score" class="score-fill aesthetic"></div></div>
                        </div>
                        <div class="score-row">
                            <span class="score-label">Fashion:</span>
                            <div class="score-bar-compact"><div id="trend-score" class="score-fill trend"></div></div>
                        </div>
                        <div class="score-row">
                            <span class="score-label">Harmony:</span>
                            <div class="score-bar-compact"><div id="harmony-score" class="score-fill harmony"></div></div>
                        </div>
                        <div class="total-value-row">
                            <strong>Value: <span id="arrangement-value">$0</span></strong>
                        </div>
                    </div>
                    
                    <div class="shop-section presentation-section">
                        <div class="presentation-row">
                            <label>Paper:</label>
                            <div class="wrapper-options-inline">
                                <button class="wrapper-option selected" data-wrapper="classic">Classic</button>
                                <button class="wrapper-option" data-wrapper="elegant">Elegant</button>
                                <button class="wrapper-option" data-wrapper="rustic">Rustic</button>
                                <button class="wrapper-option" data-wrapper="luxury">Luxury</button>
                            </div>
                        </div>
                        <div class="presentation-row">
                            <label>Ribbon:</label>
                            <div class="ribbon-options">
                                <div class="ribbon-option selected" data-color="#8b4557" style="background: #8b4557;"></div>
                                <div class="ribbon-option" data-color="#704f38" style="background: #704f38;"></div>
                                <div class="ribbon-option" data-color="#4a5d3a" style="background: #4a5d3a;"></div>
                                <div class="ribbon-option" data-color="#b8956e" style="background: #b8956e;"></div>
                            </div>
                        </div>
                        <button id="create-shop-bouquet" class="primary-button">Complete & List</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Specimen Notebook Modal -->
        <div id="specimen-notebook-modal" class="modal hidden">
            <div class="modal-content notebook-modal">
                <span class="close" id="close-specimen-notebook">&times;</span>
                <h2> The Botanical Specimen Notebook</h2>
                <p class="hint">A complete record of all species cultivated in your garden</p>
                <div id="specimen-list" class="specimen-list"></div>
                <div class="notebook-footer">
                    <button id="close-specimen-btn" class="return-button"> Return to Garden</button>
                </div>
            </div>
        </div>        <!-- Upgrade Modal -->
            </div>
        </div>

        <!-- Upgrade Modal -->
        <div id="upgrade-modal" class="modal hidden">
            <div class="modal-content">
                <h2>🔧 Upgrades</h2>
                <div id="upgrades-list" class="upgrades-list"></div>
                <button id="close-upgrades" class="action-btn">Close</button>
            </div>
        </div>

        <!-- Footer with upgrade button -->
        <footer>
            <button id="flower-shop-btn" class="action-btn shop-btn">Enter the Flower Shoppe</button>
            <button id="specimen-notebook-btn" class="action-btn">Specimen Notebook</button>
            <button id="upgrades-btn" class="action-btn">Improvements</button>
            <button id="help-btn" class="action-btn">Instructions</button>
        </footer>

        <!-- Help Modal -->
        <div id="help-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Instructions for the Gardener</h2>
                <div class="help-content">
                    <h3>§ Planting</h3>
                    <p>Select a seed variety from the catalogue, then choose an empty plot in your garden to sow it.</p>
                    
                    <h3>§ Cultivation</h3>
                    <p>Plants require regular watering. Click upon a plant to water it individually, or employ "Water All" for convenience. Advance time with "Advance Day".</p>
                    
                    <h3>§ Harvesting</h3>
                    <p>When a plant reaches maturity (indicated by its full bloom), click to harvest. Specimens are placed in your collection.</p>
                    
                    <h3>§ Arrangements</h3>
                    <p>Select flowers from your collection to compose bouquets. Different combinations yield different valuations.</p>
                    
                    <h3>§ The Market</h3>
                    <p>Each week brings different demands. Sell arrangements that match current fashions for premium prices. Conclude the week to sell all prepared bouquets.</p>
                    
                    <h3>§ Improvements</h3>
                    <p>Save your earnings to purchase improvements: larger gardens, exotic seeds, and superior tools.</p>
                </div>
                <button id="close-help" class="action-btn">I Understand</button>
            </div>
        </div>

        <!-- Notification area -->
        <div id="notifications" class="notifications"></div>
    </div>

    
    <script>
// botanical-illustrations.js - Victorian-style SVG botanical illustrations
// Procedural flower generator based on real botanical characteristics

// Botanical characteristics database - based on real flower anatomy
const BOTANICAL_DATA = {
  // Petal configurations (based on real flower families)
  petalPatterns: {
    rose: { count: [20, 25, 30], layered: true, overlap: 0.3, curve: 'spiral' },
    tulip: { count: 6, layered: false, closed: true, curve: 'smooth' },
    daisy: { count: [16, 21, 34], layered: false, radial: true, curve: 'straight' },  // Fibonacci numbers
    lily: { count: 6, layered: false, recurved: true, curve: 'wavy' },
    orchid: { count: 3, specialized: true, labellum: true, curve: 'complex' },
    poppy: { count: 4, layered: false, papery: true, curve: 'ruffled' },
    carnation: { count: [20, 30], layered: true, serrated: true, curve: 'frilled' },
    sunflower: { ray: [13, 21, 34], disk: 'fibonacci', curve: 'straight' },  // Fibonacci spiral
    iris: { count: 6, falls: 3, standards: 3, curve: 'wavy' },
    peony: { count: [50, 100], layered: true, ruffly: true, curve: 'complex' }
  }
};

// Enhanced procedural flower generator with real botanical accuracy
function createBotanicalSVG(flower) {
  const color = flower.color;
  const common = flower.common;
  const scientificFamily = determineFlowerFamily(flower);
  
  // Realistic color palettes based on actual pigments
  const colorPalettes = {
    red: { 
      primary: '#dc143c', secondary: '#ff4757', dark: '#8b0000', light: '#ff6b7a',
      accent: '#c0392b', highlight: '#ff9999', shadow: '#660000'
    },
    pink: { 
      primary: '#ff69b4', secondary: '#ffb6c1', dark: '#c71585', light: '#ffc0cb',
      accent: '#ff1493', highlight: '#ffe4e1', shadow: '#8b2252'
    },
    yellow: { 
      primary: '#ffd700', secondary: '#f9e79f', dark: '#daa520', light: '#fff8dc',
      accent: '#ffed4e', highlight: '#fffacd', shadow: '#b8860b'
    },
    orange: { 
      primary: '#ff8c00', secondary: '#ffa500', dark: '#d2691e', light: '#ffe4b5',
      accent: '#ff6347', highlight: '#ffdab9', shadow: '#8b4513'
    },
    purple: { 
      primary: '#9370db', secondary: '#dda0dd', dark: '#6a5acd', light: '#e6e6fa',
      accent: '#8a2be2', highlight: '#f8f4ff', shadow: '#4b0082'
    },
    blue: { 
      primary: '#4169e1', secondary: '#87ceeb', dark: '#191970', light: '#b0e0e6',
      accent: '#1e90ff', highlight: '#e0f6ff', shadow: '#000080'
    },
    white: { 
      primary: '#fff', secondary: '#f8f8ff', dark: '#e8e8e8', light: '#fffafa',
      accent: '#f5f5f5', highlight: '#ffffff', shadow: '#d3d3d3'
    },
    green: { 
      primary: '#6b8e4a', secondary: '#709448', dark: '#4a6832', light: '#98fb98',
      accent: '#8fbc8f', highlight: '#e0f0e0', shadow: '#2f4f2f'
    }
  };
  
  const palette = colorPalettes[color] || colorPalettes.pink;
  const stemColor = '#5a7c3e';
  const leafDark = '#4a6832';
  const leafMid = '#6b8e4a';
  const leafLight = '#88ab5e';
  
  // Generate detailed botanical structure
  const flowerHead = generateFlowerHead(flower, palette, scientificFamily);
  const stem = generateStem(flower);
  const leaves = generateLeaves(flower, leafDark, leafMid, leafLight);
  const details = generateBotanicalDetails(flower, palette);
  
  return `
    <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg" class="botanical-svg">
      <defs>
        ${generateGradients(flower, palette)}
        <filter id="paper-texture-${flower.id}">
          <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" result="noise"/>
          <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="0.5">
            <feDistantLight azimuth="45" elevation="35"/>
          </feDiffuseLighting>
        </filter>
      </defs>
      <g class="botanical-flower" filter="url(#paper-texture-${flower.id})" opacity="0.02">
        <rect width="100" height="140" fill="white"/>
      </g>
      <g class="botanical-flower">
        ${stem}
        ${leaves}
        ${flowerHead}
        ${details}
      </g>
    </svg>
  `;
}

function determineFlowerFamily(flower) {
  const name = flower.common.toLowerCase();
  if (name.includes('rose')) return 'rosaceae';
  if (name.includes('tulip')) return 'liliaceae';
  if (name.includes('daisy') || name.includes('sunflower') || name.includes('cosmos') || name.includes('zinnia')) return 'asteraceae';
  if (name.includes('lily')) return 'liliaceae';
  if (name.includes('orchid')) return 'orchidaceae';
  if (name.includes('poppy')) return 'papaveraceae';
  if (name.includes('carnation')) return 'caryophyllaceae';
  if (name.includes('iris')) return 'iridaceae';
  if (name.includes('peony')) return 'paeoniaceae';
  if (name.includes('lavender')) return 'lamiaceae';
  return 'generic';
}

function generateGradients(flower, palette) {
  return `
    <linearGradient id="stem-grad-${flower.id}" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#88ab5e;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#5a7c3e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4a6832;stop-opacity:1" />
    </linearGradient>
    <radialGradient id="petal-grad-${flower.id}" cx="30%" cy="30%">
      <stop offset="0%" style="stop-color:${palette.highlight};stop-opacity:1" />
      <stop offset="40%" style="stop-color:${palette.light};stop-opacity:1" />
      <stop offset="70%" style="stop-color:${palette.primary};stop-opacity:1" />
      <stop offset="100%" style="stop-color:${palette.dark};stop-opacity:0.95" />
    </radialGradient>
    <radialGradient id="center-grad-${flower.id}">
      <stop offset="0%" style="stop-color:${palette.accent};stop-opacity:1" />
      <stop offset="100%" style="stop-color:${palette.dark};stop-opacity:1" />
    </radialGradient>
  `;
}

function generateStem(flower) {
  const height = 90 + flower.growth * 5;
  const thickness = 2 + flower.growth * 0.4;
  const curve = 48 - flower.growth * 0.5;
  
  return `
    <!-- Main stem with natural curve -->
    <path d="M 50 140 Q ${curve} ${height + 20} 50 ${60 - flower.growth * 2}" 
          stroke="url(#stem-grad-${flower.id})" 
          stroke-width="${thickness}" 
          fill="none"
          stroke-linecap="round"/>
    <!-- Stem highlights for 3D effect -->
    <path d="M 50 140 Q ${curve + 1} ${height + 20} 51 ${60 - flower.growth * 2}" 
          stroke="rgba(136,171,94,0.6)" 
          stroke-width="${thickness * 0.3}" 
          fill="none"
          stroke-linecap="round"/>
  `;
}

function generateLeaves(flower, darkGreen, midGreen, lightGreen) {
  const leafCount = Math.min(2 + Math.floor(flower.rarity), 4);
  let leaves = '';
  
  for (let i = 0; i < leafCount; i++) {
    const side = i % 2 === 0 ? -1 : 1;
    const yPos = 95 - (i * 15) - flower.growth * 3;
    const xOffset = side * (20 + i * 5);
    const leafSize = 15 + flower.rarity * 2;
    
    leaves += `
      <!-- Leaf ${i + 1} -->
      <g>
        <!-- Leaf blade -->
        <path d="M ${50 + side * 2} ${yPos} 
                 Q ${50 + xOffset * 0.7} ${yPos - 3} ${50 + xOffset} ${yPos + 2}
                 Q ${50 + xOffset + side * 2} ${yPos + leafSize * 0.5} ${50 + xOffset - side * 3} ${yPos + leafSize}
                 Q ${50 + xOffset * 0.5} ${yPos + leafSize - 2} ${50 + side * 2} ${yPos + leafSize - 5}
                 Z" 
              fill="${midGreen}" 
              stroke="${darkGreen}" 
              stroke-width="0.8"/>
        <!-- Leaf vein -->
        <path d="M ${50 + side * 2} ${yPos + 2} Q ${50 + xOffset * 0.7} ${yPos + leafSize * 0.3} ${50 + xOffset - side * 3} ${yPos + leafSize - 2}" 
              stroke="${lightGreen}" 
              stroke-width="0.5" 
              fill="none"
              opacity="0.7"/>
        <!-- Secondary veins -->
        ${Array.from({length: 3}, (_, v) => {
          const vPos = yPos + (v + 1) * (leafSize / 4);
          return `<path d="M ${50 + xOffset * 0.7} ${vPos} L ${50 + xOffset * 0.9} ${vPos + 2}" stroke="${lightGreen}" stroke-width="0.3" opacity="0.5"/>`;
        }).join('')}
      </g>
    `;
  }
  
  return leaves;
}

function generateFlowerHead(flower, palette, family) {
  const centerY = 35 - flower.growth * 1.5;
  
  // Generate family-specific flower structures
  switch(family) {
    case 'rosaceae':
      return generateRoseFlower(50, centerY, palette, flower);
    case 'asteraceae':
      return generateDaisyFlower(50, centerY, palette, flower);
    case 'liliaceae':
      if (flower.common.includes('Tulip')) {
        return generateTulipFlower(50, centerY, palette, flower);
      }
      return generateLilyFlower(50, centerY, palette, flower);
    case 'orchidaceae':
      return generateOrchidFlower(50, centerY, palette, flower);
    case 'lamiaceae':
      return generateLavenderFlower(50, centerY, palette, flower);
    default:
      return generateGenericFlower(50, centerY, palette, flower);
  }
}

function generateRoseFlower(cx, cy, palette, flower) {
  const layers = 4;
  let petals = '';
  
  // Outer to inner layers
  for (let layer = layers; layer >= 1; layer--) {
    const petalCount = 5 + layer * 2;
    const radius = 14 - (layers - layer) * 3;
    const angleOffset = (layer % 2) * (Math.PI / petalCount);
    
    for (let i = 0; i < petalCount; i++) {
      const angle = (i / petalCount) * Math.PI * 2 + angleOffset;
      const px = cx + Math.cos(angle) * radius;
      const py = cy + Math.sin(angle) * radius;
      const petalR = 5 - layer * 0.3;
      
      petals += `
        <ellipse cx="${px}" cy="${py}" rx="${petalR}" ry="${petalR * 1.4}" 
                 fill="url(#petal-grad-${flower.id})" 
                 stroke="${palette.dark}" 
                 stroke-width="0.4"
                 opacity="${0.8 + layer * 0.05}"
                 transform="rotate(${angle * 180 / Math.PI} ${px} ${py})"/>
      `;
    }
  }
  
  // Center
  petals += `<circle cx="${cx}" cy="${cy}" r="3" fill="url(#center-grad-${flower.id})"/>`;
  
  return petals;
}

function generateDaisyFlower(cx, cy, palette, flower) {
  const petalCount = 16 + Math.floor(flower.rarity * 5);
  let petals = '';
  
  // Ray petals (ligules)
  for (let i = 0; i < petalCount; i++) {
    const angle = (i / petalCount) * Math.PI * 2;
    const px = cx + Math.cos(angle) * 13;
    const py = cy + Math.sin(angle) * 13;
    
    petals += `
      <ellipse cx="${px}" cy="${py}" rx="3.5" ry="8" 
               fill="${palette.primary}" 
               stroke="${palette.dark}" 
               stroke-width="0.4"
               transform="rotate(${angle * 180 / Math.PI} ${px} ${py})"/>
      <!-- Petal vein -->
      <line x1="${px}" y1="${py - 6}" x2="${px}" y2="${py + 6}"
            stroke="${palette.dark}" 
            stroke-width="0.2" 
            opacity="0.3"
            transform="rotate(${angle * 180 / Math.PI} ${px} ${py})"/>
    `;
  }
  
  // Disk florets with Fibonacci spiral pattern
  const diskRadius = 6;
  const floretCount = 55; // Fibonacci number
  for (let i = 0; i < floretCount; i++) {
    const theta = i * 137.5 * (Math.PI / 180); // Golden angle
    const r = Math.sqrt(i) * 0.9;
    const fx = cx + Math.cos(theta) * r;
    const fy = cy + Math.sin(theta) * r;
    
    petals += `<circle cx="${fx}" cy="${fy}" r="0.7" fill="#d4af37" opacity="0.9"/>`;
  }
  
  // Center highlight
  petals += `<circle cx="${cx}" cy="${cy}" r="4" fill="#f4d03f" opacity="0.6"/>`;
  
  return petals;
}

function generateTulipFlower(cx, cy, palette, flower) {
  return `
    <!-- Tulip cup shape -->
    <ellipse cx="${cx}" cy="${cy + 2}" rx="11" ry="18" fill="${palette.primary}" stroke="${palette.dark}" stroke-width="1"/>
    <path d="M ${cx - 11} ${cy + 5} Q ${cx - 11} ${cy - 10} ${cx} ${cy - 18} Q ${cx + 11} ${cy - 10} ${cx + 11} ${cy + 5}" 
          fill="${palette.secondary}" stroke="${palette.dark}" stroke-width="1"/>
    <!-- Inner petals -->
    <ellipse cx="${cx - 5}" cy="${cy}" rx="6" ry="14" fill="${palette.light}" stroke="${palette.dark}" stroke-width="0.6" opacity="0.8"/>
    <ellipse cx="${cx + 5}" cy="${cy}" rx="6" ry="14" fill="${palette.light}" stroke="${palette.dark}" stroke-width="0.6" opacity="0.8"/>
    <!-- Petal veining -->
    ${Array.from({length: 5}, (_, i) => `
      <line x1="${cx}" y1="${cy - 15 + i * 3}" x2="${cx}" y2="${cy + 10}" 
            stroke="${palette.dark}" stroke-width="0.3" opacity="0.2"/>
    `).join('')}
  `;
}

function generateLilyFlower(cx, cy, palette, flower) {
  const petals = 6;
  let flower_petals = '';
  
  for (let i = 0; i < petals; i++) {
    const angle = (i / petals) * Math.PI * 2 - Math.PI / 2;
    const px = cx + Math.cos(angle) * 15;
    const py = cy + Math.sin(angle) * 15;
    
    flower_petals += `
      <ellipse cx="${px}" cy="${py}" rx="4.5" ry="14" 
               fill="url(#petal-grad-${flower.id})" 
               stroke="${palette.dark}" 
               stroke-width="0.6"
               transform="rotate(${angle * 180 / Math.PI + 90} ${px} ${py})"/>
      <!-- Stamen extending from center -->
      <line x1="${cx + Math.cos(angle) * 3}" y1="${cy + Math.sin(angle) * 3}" 
            x2="${px}" y2="${py}" 
            stroke="${palette.dark}" stroke-width="0.5"/>
      <circle cx="${px}" cy="${py}" r="1.2" fill="#f4d03f"/>
    `;
  }
  
  return flower_petals;
}

function generateOrchidFlower(cx, cy, palette, flower) {
  return `
    <!-- Dorsal sepal -->
    <ellipse cx="${cx}" cy="${cy - 12}" rx="7" ry="10" fill="${palette.primary}" stroke="${palette.dark}" stroke-width="0.6"/>
    <!-- Lateral sepals -->
    <ellipse cx="${cx - 8}" cy="${cy - 2}" rx="6" ry="9" fill="${palette.secondary}" stroke="${palette.dark}" stroke-width="0.6" transform="rotate(-25 ${cx - 8} ${cy - 2})"/>
    <ellipse cx="${cx + 8}" cy="${cy - 2}" rx="6" ry="9" fill="${palette.secondary}" stroke="${palette.dark}" stroke-width="0.6" transform="rotate(25 ${cx + 8} ${cy - 2})"/>
    <!-- Labellum (lip) - most distinctive orchid feature -->
    <path d="M ${cx} ${cy + 2} Q ${cx - 10} ${cy + 5} ${cx - 12} ${cy + 12} Q ${cx - 10} ${cy + 18} ${cx} ${cy + 16} Q ${cx + 10} ${cy + 18} ${cx + 12} ${cy + 12} Q ${cx + 10} ${cy + 5} ${cx} ${cy + 2} Z" 
          fill="${palette.light}" stroke="${palette.dark}" stroke-width="0.7"/>
    <path d="M ${cx} ${cy + 4} Q ${cx - 6} ${cy + 7} ${cx - 7} ${cy + 12} Q ${cx - 5} ${cy + 15} ${cx} ${cy + 14} Q ${cx + 5} ${cy + 15} ${cx + 7} ${cy + 12} Q ${cx + 6} ${cy + 7} ${cx} ${cy + 4} Z" 
          fill="${palette.accent}" stroke="${palette.dark}" stroke-width="0.4"/>
    <!-- Column (reproductive structure) -->
    <ellipse cx="${cx}" cy="${cy}" rx="2" ry="4" fill="${palette.dark}"/>
  `;
}

function generateLavenderFlower(cx, cy, palette, flower) {
  let spikes = '';
  const stems = 3;
  
  for (let s = 0; s < stems; s++) {
    const sx = cx + (s - 1) * 8;
    const floretCount = 8 + Math.floor(flower.rarity * 2);
    
    // Individual florets on spike
    for (let i = 0; i < floretCount; i++) {
      const fy = cy - 15 + i * 3;
      spikes += `
        <ellipse cx="${sx}" cy="${fy}" rx="3" ry="1.8" 
                 fill="${palette.primary}" 
                 stroke="${palette.dark}" 
                 stroke-width="0.3"/>
      `;
    }
    
    // Spike stem
    spikes += `<line x1="${sx}" y1="${cy + 10}" x2="${sx}" y2="${cy - 15}" stroke="#5a7c3e" stroke-width="1.2"/>`;
  }
  
  return spikes;
}

function generateGenericFlower(cx, cy, palette, flower) {
  const petalCount = 5 + Math.floor(flower.rarity);
  let petals = '';
  
  for (let i = 0; i < petalCount; i++) {
    const angle = (i / petalCount) * Math.PI * 2;
    const px = cx + Math.cos(angle) * 12;
    const py = cy + Math.sin(angle) * 12;
    
    petals += `
      <ellipse cx="${px}" cy="${py}" rx="5" ry="9" 
               fill="url(#petal-grad-${flower.id})" 
               stroke="${palette.dark}" 
               stroke-width="0.5"
               transform="rotate(${angle * 180 / Math.PI} ${px} ${py})"/>
    `;
  }
  
  petals += `<circle cx="${cx}" cy="${cy}" r="4" fill="url(#center-grad-${flower.id})"/>`;
  
  return petals;
}

function generateBotanicalDetails(flower, palette) {
  // Add scientific details like stamens, pistils, etc.
  const cx = 50;
  const cy = 35 - flower.growth * 1.5;
  
  return `
    <!-- Stamens -->
    ${Array.from({length: 5}, (_, i) => {
      const angle = (i / 5) * Math.PI * 2;
      const sx = cx + Math.cos(angle) * 4;
      const sy = cy + Math.sin(angle) * 4;
      return `
        <line x1="${cx}" y1="${cy}" x2="${sx}" y2="${sy}" stroke="${palette.dark}" stroke-width="0.5"/>
        <circle cx="${sx}" cy="${sy}" r="0.9" fill="#f4d03f" stroke="${palette.dark}" stroke-width="0.3"/>
      `;
    }).join('')}
  `;
}

// Main function to get botanical illustration
function getBotanicalIllustration(flowerId) {
  const flower = FLOWER_TYPES.find(f => f.id === flowerId);
  if (!flower) return '';
  return createBotanicalSVG(flower);
}

</script>
    <script>
// game.js - My Flower Garden - A Botanical Journal Game

// ========== GAME DATA ==========
const FLOWER_TYPES = [
  // Common flowers (unlocked at start)
  { id: 'dandelion', name: 'Taraxacum officinale', common: 'Dandelion', cost: 2, growth: 1, water: 1, rarity: 0.5, baseValue: 3, color: 'yellow' },
  { id: 'fern', name: 'Nephrolepis exaltata', common: 'Boston Fern', cost: 5, growth: 2, water: 1, rarity: 1, baseValue: 5, color: 'green' },
  { id: 'tulip', name: 'Tulipa gesneriana', common: 'Garden Tulip', cost: 8, growth: 3, water: 2, rarity: 1, baseValue: 8, color: 'red' },
  { id: 'marigold', name: 'Tagetes erecta', common: 'African Marigold', cost: 6, growth: 2, water: 2, rarity: 1, baseValue: 6, color: 'orange' },
  { id: 'daisy', name: 'Bellis perennis', common: 'Common Daisy', cost: 6, growth: 2, water: 1, rarity: 1, baseValue: 6, color: 'white' },
  
  // Tier 1 - Low cost (locked initially)
  { id: 'pansy', name: 'Viola tricolor', common: 'Wild Pansy', cost: 9, growth: 3, water: 2, rarity: 1.2, baseValue: 9, color: 'purple', locked: true },
  { id: 'zinnia', name: 'Zinnia elegans', common: 'Youth-and-Age', cost: 11, growth: 3, water: 2, rarity: 1.3, baseValue: 10, color: 'pink', locked: true },
  { id: 'cosmos', name: 'Cosmos bipinnatus', common: 'Garden Cosmos', cost: 11, growth: 3, water: 2, rarity: 1.2, baseValue: 9, color: 'pink', locked: true },
  { id: 'snapdragon', name: 'Antirrhinum majus', common: 'Snapdragon', cost: 12, growth: 3, water: 2, rarity: 1.4, baseValue: 11, color: 'red', locked: true },
  { id: 'sunflower', name: 'Helianthus annuus', common: 'Common Sunflower', cost: 12, growth: 4, water: 2, rarity: 1.5, baseValue: 12, color: 'yellow', locked: true },
  
  // Tier 2 - Medium cost
  { id: 'rose', name: 'Rosa hybrida', common: 'Hybrid Tea Rose', cost: 23, growth: 5, water: 3, rarity: 2, baseValue: 20, color: 'red', locked: true },
  { id: 'lily', name: 'Lilium candidum', common: 'Madonna Lily', cost: 18, growth: 4, water: 2, rarity: 1.8, baseValue: 18, color: 'white', locked: true },
  { id: 'iris', name: 'Iris germanica', common: 'Bearded Iris', cost: 20, growth: 4, water: 2, rarity: 1.7, baseValue: 17, color: 'purple', locked: true },
  { id: 'carnation', name: 'Dianthus caryophyllus', common: 'Carnation', cost: 15, growth: 4, water: 2, rarity: 1.6, baseValue: 14, color: 'pink', locked: true },
  { id: 'chrysanthemum', name: 'Chrysanthemum morifolium', common: 'Florist Mum', cost: 17, growth: 4, water: 2, rarity: 1.6, baseValue: 15, color: 'yellow', locked: true },
  { id: 'dahlia', name: 'Dahlia pinnata', common: 'Garden Dahlia', cost: 21, growth: 5, water: 3, rarity: 1.9, baseValue: 19, color: 'red', locked: true },
  { id: 'peony', name: 'Paeonia lactiflora', common: 'Chinese Peony', cost: 24, growth: 5, water: 3, rarity: 2.1, baseValue: 22, color: 'pink', locked: true },
  { id: 'hydrangea', name: 'Hydrangea macrophylla', common: 'Bigleaf Hydrangea', cost: 23, growth: 5, water: 3, rarity: 2, baseValue: 21, color: 'blue', locked: true },
  
  // Tier 3 - High cost
  { id: 'orchid-phalaenopsis', name: 'Phalaenopsis amabilis', common: 'Moth Orchid', cost: 38, growth: 6, water: 3, rarity: 2.5, baseValue: 35, color: 'white', locked: true },
  { id: 'orchid-cattleya', name: 'Cattleya labiata', common: 'Corsage Orchid', cost: 42, growth: 6, water: 3, rarity: 2.6, baseValue: 38, color: 'purple', locked: true },
  { id: 'protea', name: 'Protea cynaroides', common: 'King Protea', cost: 45, growth: 7, water: 3, rarity: 2.8, baseValue: 42, color: 'pink', locked: true },
  { id: 'delphinium', name: 'Delphinium elatum', common: 'Candle Larkspur', cost: 30, growth: 5, water: 3, rarity: 2.2, baseValue: 28, color: 'blue', locked: true },
  { id: 'anemone', name: 'Anemone coronaria', common: 'Poppy Anemone', cost: 27, growth: 5, water: 2, rarity: 2, baseValue: 24, color: 'red', locked: true },
  { id: 'ranunculus', name: 'Ranunculus asiaticus', common: 'Persian Buttercup', cost: 33, growth: 5, water: 3, rarity: 2.3, baseValue: 30, color: 'pink', locked: true },
  { id: 'gardenia', name: 'Gardenia jasminoides', common: 'Cape Jasmine', cost: 36, growth: 6, water: 3, rarity: 2.4, baseValue: 32, color: 'white', locked: true },
  { id: 'camellia', name: 'Camellia japonica', common: 'Japanese Camellia', cost: 35, growth: 6, water: 3, rarity: 2.3, baseValue: 31, color: 'red', locked: true },
  
  // Tier 4 - Very high cost (exotic)
  { id: 'bird-of-paradise', name: 'Strelitzia reginae', common: 'Crane Flower', cost: 60, growth: 8, water: 4, rarity: 3, baseValue: 55, color: 'orange', locked: true },
  { id: 'calla-lily', name: 'Zantedeschia aethiopica', common: 'Calla Lily', cost: 53, growth: 7, water: 3, rarity: 2.8, baseValue: 48, color: 'white', locked: true },
  { id: 'amaryllis', name: 'Hippeastrum hybridum', common: 'Amaryllis', cost: 48, growth: 6, water: 3, rarity: 2.7, baseValue: 45, color: 'red', locked: true },
  { id: 'hellebore', name: 'Helleborus niger', common: 'Christmas Rose', cost: 57, growth: 7, water: 3, rarity: 2.9, baseValue: 52, color: 'white', locked: true },
  { id: 'passion-flower', name: 'Passiflora caerulea', common: 'Blue Passionflower', cost: 54, growth: 7, water: 4, rarity: 2.8, baseValue: 50, color: 'blue', locked: true },
  { id: 'lotus', name: 'Nelumbo nucifera', common: 'Sacred Lotus', cost: 68, growth: 8, water: 5, rarity: 3.2, baseValue: 62, color: 'pink', locked: true },
  { id: 'magnolia', name: 'Magnolia grandiflora', common: 'Southern Magnolia', cost: 63, growth: 8, water: 4, rarity: 3.1, baseValue: 58, color: 'white', locked: true },
  { id: 'wisteria', name: 'Wisteria sinensis', common: 'Chinese Wisteria', cost: 57, growth: 7, water: 3, rarity: 2.9, baseValue: 53, color: 'purple', locked: true },
  
  // Tier 5 - Premium/Rare
  { id: 'blue-poppy', name: 'Meconopsis betonicifolia', common: 'Himalayan Blue Poppy', cost: 90, growth: 9, water: 4, rarity: 3.5, baseValue: 80, color: 'blue', locked: true },
  { id: 'ghost-orchid', name: 'Dendrophylax lindenii', common: 'Ghost Orchid', cost: 113, growth: 10, water: 4, rarity: 4, baseValue: 100, color: 'white', locked: true },
  { id: 'juliet-rose', name: 'Rosa \'Sweet Juliet\'', common: 'Juliet Rose', cost: 98, growth: 9, water: 4, rarity: 3.7, baseValue: 88, color: 'peach', locked: true },
  { id: 'kadupul', name: 'Epiphyllum oxypetalum', common: 'Queen of the Night', cost: 120, growth: 10, water: 5, rarity: 4.2, baseValue: 110, color: 'white', locked: true },
  { id: 'chocolate-cosmos', name: 'Cosmos atrosanguineus', common: 'Chocolate Cosmos', cost: 83, growth: 8, water: 3, rarity: 3.3, baseValue: 75, color: 'brown', locked: true },
  { id: 'parrot-flower', name: 'Impatiens psittacina', common: 'Parrot Flower', cost: 105, growth: 9, water: 4, rarity: 3.8, baseValue: 95, color: 'red', locked: true },
  { id: 'jade-vine', name: 'Strongylodon macrobotrys', common: 'Jade Vine', cost: 102, growth: 9, water: 4, rarity: 3.7, baseValue: 92, color: 'jade', locked: true },
  { id: 'middlemist-red', name: 'Camellia \'Middlemist\'', common: 'Middlemist Red', cost: 135, growth: 11, water: 5, rarity: 4.5, baseValue: 125, color: 'pink', locked: true },
  { id: 'corpse-flower', name: 'Amorphophallus titanum', common: 'Titan Arum', cost: 128, growth: 12, water: 5, rarity: 4.3, baseValue: 115, color: 'purple', locked: true },
  { id: 'black-bat', name: 'Tacca chantrieri', common: 'Black Bat Flower', cost: 108, growth: 9, water: 4, rarity: 3.9, baseValue: 98, color: 'black', locked: true },
  { id: 'bleeding-heart', name: 'Lamprocapnos spectabilis', common: 'Bleeding Heart', cost: 42, growth: 6, water: 3, rarity: 2.5, baseValue: 38, color: 'pink', locked: true },
  { id: 'foxglove', name: 'Digitalis purpurea', common: 'Common Foxglove', cost: 29, growth: 5, water: 2, rarity: 2.1, baseValue: 26, color: 'purple', locked: true },
  { id: 'edelweiss', name: 'Leontopodium alpinum', common: 'Edelweiss', cost: 72, growth: 8, water: 3, rarity: 3.2, baseValue: 65, color: 'white', locked: true },
  { id: 'fire-lily', name: 'Gloriosa superba', common: 'Flame Lily', cost: 78, growth: 8, water: 4, rarity: 3.3, baseValue: 70, color: 'red', locked: true },
];

const UPGRADES = [
  { id: 'garden-6x6', name: 'Expand Garden to 6×6', cost: 150, type: 'garden', value: 6 },
  { id: 'garden-8x8', name: 'Expand Garden to 8×8', cost: 375, type: 'garden', value: 8 },
  { id: 'garden-10x10', name: 'Expand Garden to 10×10', cost: 750, type: 'garden', value: 10 },
  { id: 'garden-12x12', name: 'Expand Garden to 12×12', cost: 1500, type: 'garden', value: 12 },
  { id: 'garden-16x16', name: 'Expand Garden to 16×16', cost: 3750, type: 'garden', value: 16 },
  
  // Tier 1 unlocks
  { id: 'unlock-pansy', name: 'Unlock Pansy Seeds', cost: 45, type: 'seed', value: 'pansy' },
  { id: 'unlock-zinnia', name: 'Unlock Zinnia Seeds', cost: 53, type: 'seed', value: 'zinnia' },
  { id: 'unlock-cosmos', name: 'Unlock Cosmos Seeds', cost: 53, type: 'seed', value: 'cosmos' },
  { id: 'unlock-snapdragon', name: 'Unlock Snapdragon Seeds', cost: 60, type: 'seed', value: 'snapdragon' },
  { id: 'unlock-sunflower', name: 'Unlock Sunflower Seeds', cost: 68, type: 'seed', value: 'sunflower' },
  
  // Tier 2 unlocks
  { id: 'unlock-rose', name: 'Unlock Rose Seeds', cost: 120, type: 'seed', value: 'rose' },
  { id: 'unlock-lily', name: 'Unlock Lily Seeds', cost: 105, type: 'seed', value: 'lily' },
  { id: 'unlock-iris', name: 'Unlock Iris Seeds', cost: 113, type: 'seed', value: 'iris' },
  { id: 'unlock-carnation', name: 'Unlock Carnation Seeds', cost: 90, type: 'seed', value: 'carnation' },
  { id: 'unlock-chrysanthemum', name: 'Unlock Chrysanthemum Seeds', cost: 98, type: 'seed', value: 'chrysanthemum' },
  { id: 'unlock-dahlia', name: 'Unlock Dahlia Seeds', cost: 128, type: 'seed', value: 'dahlia' },
  { id: 'unlock-peony', name: 'Unlock Peony Seeds', cost: 135, type: 'seed', value: 'peony' },
  { id: 'unlock-hydrangea', name: 'Unlock Hydrangea Seeds', cost: 128, type: 'seed', value: 'hydrangea' },
  
  // Tier 3 unlocks
  { id: 'unlock-orchid-phalaenopsis', name: 'Unlock Moth Orchid Seeds', cost: 225, type: 'seed', value: 'orchid-phalaenopsis' },
  { id: 'unlock-orchid-cattleya', name: 'Unlock Corsage Orchid Seeds', cost: 240, type: 'seed', value: 'orchid-cattleya' },
  { id: 'unlock-protea', name: 'Unlock Protea Seeds', cost: 270, type: 'seed', value: 'protea' },
  { id: 'unlock-delphinium', name: 'Unlock Delphinium Seeds', cost: 180, type: 'seed', value: 'delphinium' },
  { id: 'unlock-anemone', name: 'Unlock Anemone Seeds', cost: 165, type: 'seed', value: 'anemone' },
  { id: 'unlock-ranunculus', name: 'Unlock Ranunculus Seeds', cost: 195, type: 'seed', value: 'ranunculus' },
  { id: 'unlock-gardenia', name: 'Unlock Gardenia Seeds', cost: 218, type: 'seed', value: 'gardenia' },
  { id: 'unlock-camellia', name: 'Unlock Camellia Seeds', cost: 210, type: 'seed', value: 'camellia' },
  { id: 'unlock-bleeding-heart', name: 'Unlock Bleeding Heart Seeds', cost: 248, type: 'seed', value: 'bleeding-heart' },
  { id: 'unlock-foxglove', name: 'Unlock Foxglove Seeds', cost: 173, type: 'seed', value: 'foxglove' },
  
  // Tier 4 unlocks
  { id: 'unlock-bird-of-paradise', name: 'Unlock Bird of Paradise Seeds', cost: 375, type: 'seed', value: 'bird-of-paradise' },
  { id: 'unlock-calla-lily', name: 'Unlock Calla Lily Seeds', cost: 330, type: 'seed', value: 'calla-lily' },
  { id: 'unlock-amaryllis', name: 'Unlock Amaryllis Seeds', cost: 300, type: 'seed', value: 'amaryllis' },
  { id: 'unlock-hellebore', name: 'Unlock Hellebore Seeds', cost: 360, type: 'seed', value: 'hellebore' },
  { id: 'unlock-passion-flower', name: 'Unlock Passion Flower Seeds', cost: 345, type: 'seed', value: 'passion-flower' },
  { id: 'unlock-lotus', name: 'Unlock Lotus Seeds', cost: 420, type: 'seed', value: 'lotus' },
  { id: 'unlock-magnolia', name: 'Unlock Magnolia Seeds', cost: 390, type: 'seed', value: 'magnolia' },
  { id: 'unlock-wisteria', name: 'Unlock Wisteria Seeds', cost: 360, type: 'seed', value: 'wisteria' },
  { id: 'unlock-edelweiss', name: 'Unlock Edelweiss Seeds', cost: 450, type: 'seed', value: 'edelweiss' },
  { id: 'unlock-fire-lily', name: 'Unlock Fire Lily Seeds', cost: 480, type: 'seed', value: 'fire-lily' },
  
  // Tier 5 unlocks (premium)
  { id: 'unlock-blue-poppy', name: 'Unlock Blue Poppy Seeds', cost: 600, type: 'seed', value: 'blue-poppy' },
  { id: 'unlock-ghost-orchid', name: 'Unlock Ghost Orchid Seeds', cost: 750, type: 'seed', value: 'ghost-orchid' },
  { id: 'unlock-juliet-rose', name: 'Unlock Juliet Rose Seeds', cost: 675, type: 'seed', value: 'juliet-rose' },
  { id: 'unlock-kadupul', name: 'Unlock Queen of the Night Seeds', cost: 825, type: 'seed', value: 'kadupul' },
  { id: 'unlock-chocolate-cosmos', name: 'Unlock Chocolate Cosmos Seeds', cost: 570, type: 'seed', value: 'chocolate-cosmos' },
  { id: 'unlock-parrot-flower', name: 'Unlock Parrot Flower Seeds', cost: 720, type: 'seed', value: 'parrot-flower' },
  { id: 'unlock-jade-vine', name: 'Unlock Jade Vine Seeds', cost: 705, type: 'seed', value: 'jade-vine' },
  { id: 'unlock-middlemist-red', name: 'Unlock Middlemist Red Seeds', cost: 900, type: 'seed', value: 'middlemist-red' },
  { id: 'unlock-corpse-flower', name: 'Unlock Corpse Flower Seeds', cost: 870, type: 'seed', value: 'corpse-flower' },
  { id: 'unlock-black-bat', name: 'Unlock Black Bat Flower Seeds', cost: 735, type: 'seed', value: 'black-bat' },
  
  { id: 'better-tools', name: 'Superior Watering Tools', cost: 75, type: 'tool', value: 1 },
  { id: 'advanced-tools', name: 'Advanced Watering System', cost: 225, type: 'tool', value: 2 },
];

// Game State
const GameState = {
  money: 100,
  week: 1,
  day: 1,
  gardenSize: 4,
  garden: [],
  inventory: [],
  bouquets: [],
  marketDemand: {},
  selectedSeed: null,
  currentBouquet: [],
  upgrades: [],
  toolLevel: 0,
  arrangementFlowers: [],
  selectedWrapper: 'classic',
  selectedRibbon: '#8b4557',
  selectedArrangementFlower: null,
  collectedCards: [], // Botanical illustration cards unlocked by growing each species
  grownSpecies: [], // All species ever grown (for specimen notebook)
  rotationSensitivity: 3 // Rotation degrees per click (1, 3, 5, or 15)
};

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', () => {
  console.log('Game initializing...');
  try {
    initGame();
    console.log('Game initialized');
    attachEventListeners();
    console.log('Event listeners attached');
    generateMarketDemand();
    console.log('Market demand generated');
    render();
    console.log('Render complete');
  } catch(e) {
    console.error('Initialization error:', e);
  }
});

function initGame() {
  const size = GameState.gardenSize;
  GameState.garden = Array(size * size).fill(null).map(() => null);
}

function attachEventListeners() {
  // Garden actions
  document.getElementById('water-all-btn').addEventListener('click', waterAll);
  document.getElementById('next-day-btn').addEventListener('click', advanceDay);
  
  // View toggle
  document.getElementById('grid-view-btn').addEventListener('click', () => switchView('grid'));
  document.getElementById('visual-view-btn').addEventListener('click', () => switchView('visual'));
  
  // Market
  document.getElementById('end-week-btn').addEventListener('click', endWeek);
  
  // Modals and Pages
  document.getElementById('flower-shop-btn').addEventListener('click', openFlowerShop);
  document.getElementById('close-flower-shop').addEventListener('click', closeFlowerShop);
  document.getElementById('upgrades-btn').addEventListener('click', openUpgrades);
  document.getElementById('close-upgrades').addEventListener('click', closeUpgrades);
  document.getElementById('specimen-notebook-btn').addEventListener('click', openSpecimenNotebook);
  document.getElementById('close-specimen-notebook').addEventListener('click', closeSpecimenNotebook);
  document.getElementById('close-specimen-btn').addEventListener('click', closeSpecimenNotebook);
  document.getElementById('help-btn').addEventListener('click', openHelp);
  document.getElementById('close-help').addEventListener('click', closeHelp);
  
  // Shop bouquet and arrangement tools - Victorian controls
  document.getElementById('create-shop-bouquet').addEventListener('click', createShopBouquet);
  document.getElementById('clear-arrangement').addEventListener('click', clearArrangement);
  document.getElementById('copy-flower-btn').addEventListener('click', copySelectedFlower);
  document.getElementById('set-straight-btn').addEventListener('click', setStraight);
  document.getElementById('rotate-counter-btn').addEventListener('click', () => rotateSelectedFlower(false));
  document.getElementById('rotate-clockwise-btn').addEventListener('click', () => rotateSelectedFlower(true));
  document.getElementById('size-up').addEventListener('click', () => resizeSelectedFlower(1.2));
  document.getElementById('size-down').addEventListener('click', () => resizeSelectedFlower(0.8));
  document.getElementById('sensitivity-dial').addEventListener('click', cycleSensitivity);
  
  // Wrapper and ribbon selection
  document.querySelectorAll('.wrapper-option').forEach(opt => {
    opt.addEventListener('click', () => selectWrapper(opt.dataset.wrapper));
  });
  document.querySelectorAll('.ribbon-option').forEach(opt => {
    opt.addEventListener('click', () => selectRibbon(opt.dataset.color));
  });
}

// ========== RENDERING ==========
function render() {
  console.log('Starting render...');
  renderStats();
  renderGarden();
  renderSeedShop();
  renderInventory();
  renderHerbarium();
  renderMarketDemand();
  renderBouquetsForSale();
  console.log('Render functions complete');
}

function renderStats() {
  document.getElementById('money').textContent = `$${GameState.money}`;
  const moneyDisplay = document.getElementById('money-display');
  if (moneyDisplay) moneyDisplay.textContent = `$${GameState.money}`;
  document.getElementById('week').textContent = GameState.week;
  document.getElementById('garden-size').textContent = `${GameState.gardenSize}×${GameState.gardenSize}`;
}

function renderGarden() {
  const grid = document.getElementById('garden-grid');
  grid.innerHTML = '';
  grid.style.gridTemplateColumns = `repeat(${GameState.gardenSize}, 80px)`;
  
  GameState.garden.forEach((plant, idx) => {
    const plot = document.createElement('div');
    plot.className = 'plot';
    
    if (plant) {
      const growthPercent = plant.stage / plant.growth;
      const scale = 0.5 + (growthPercent * 0.5); // Scale from 0.5 to 1.0
      const flowerSymbol = plant.stage >= plant.growth ? '✿' : '❀';
      plot.innerHTML = `<div class="flower-visual" data-color="${plant.color}" style="transform: scale(${scale})">${flowerSymbol}</div>`;
      plot.title = `${plant.common}\n(${plant.name})\nStage: ${plant.stage}/${plant.growth}\nWater: ${plant.watered}/${plant.water}\nClick to ${plant.stage >= plant.growth ? 'harvest' : 'water'}`;
      
      if (plant.stage >= plant.growth) {
        plot.classList.add('ready');
        plot.style.background = '#d4f4dd';
      } else if (plant.stage > 0) {
        plot.style.background = '#e8f5e9';
      }
      
      plot.addEventListener('click', () => handlePlotClick(idx));
    } else {
      plot.textContent = '+';
      plot.title = 'Plant a seed';
      plot.addEventListener('click', () => plantSeed(idx));
    }
    
    grid.appendChild(plot);
  });
  
  renderVisualGarden();
}

function renderVisualGarden() {
  const visualPlants = document.getElementById('visual-plants');
  if (!visualPlants) return;
  
  visualPlants.innerHTML = '';
  
  // Create soil rows first
  const gardenScene = document.querySelector('.garden-scene');
  if (gardenScene) {
    gardenScene.innerHTML = '';
    const size = GameState.gardenSize;
    const rowHeight = 60;
    
    for (let row = 0; row < size; row++) {
      const soilRow = document.createElement('div');
      soilRow.className = 'soil-row';
      soilRow.style.position = 'absolute';
      soilRow.style.bottom = `${row * rowHeight}px`;
      soilRow.style.left = '0';
      soilRow.style.right = '0';
      soilRow.style.height = `${rowHeight}px`;
      soilRow.style.background = `linear-gradient(to bottom, #8B7355 0%, #6B5345 100%)`;
      soilRow.style.borderTop = '2px solid #5a4a3a';
      soilRow.style.borderBottom = '1px dashed #9B8365';
      gardenScene.appendChild(soilRow);
    }
    
    // Re-add visual plants container
    const plantsContainer = document.createElement('div');
    plantsContainer.id = 'visual-plants';
    plantsContainer.className = 'visual-plants';
    gardenScene.appendChild(plantsContainer);
  }
  
  const plantsContainer = document.getElementById('visual-plants');
  if (!plantsContainer) return;
  
  GameState.garden.forEach((plant, idx) => {
    if (!plant) return;
    
    const growthPercent = plant.stage / plant.growth;
    const row = Math.floor(idx / GameState.gardenSize);
    const col = idx % GameState.gardenSize;
    const size = GameState.gardenSize;
    
    // Calculate position within the soil row with slight random offset for natural look
    const colWidth = 100 / size;
    const randomOffset = (idx % 3 - 1) * 2; // Small offset: -2, 0, or 2
    
    const visualPlant = document.createElement('div');
    visualPlant.className = 'visual-plant botanical-plant';
    visualPlant.style.left = `${col * colWidth + colWidth / 2 + randomOffset}%`;
    visualPlant.style.bottom = `${row * 60 + 10}px`;
    
    // Scale flowers based on growth - much larger at full size
    const minSize = 40;
    const maxSize = 90;
    const flowerSize = minSize + (growthPercent * (maxSize - minSize));
    visualPlant.style.width = `${flowerSize}px`;
    visualPlant.style.height = `${flowerSize * 1.2}px`;
    visualPlant.style.opacity = `${0.5 + (growthPercent * 0.5)}`;
    visualPlant.title = `${plant.common}\n(${plant.name})`;
    
    // Show full color botanical illustration for mature plants
    if (plant.stage >= plant.growth) {
      visualPlant.innerHTML = getBotanicalIllustration(plant.id);
      visualPlant.classList.add('mature-flower');
      // Add gentle sway animation
      visualPlant.style.animation = `sway ${3 + (idx % 3)}s ease-in-out infinite`;
      visualPlant.style.animationDelay = `${idx * 0.2}s`;
    } else if (GameState.collectedCards.includes(plant.id) && plant.stage >= plant.growth * 0.5) {
      // Show muted botanical illustration for growing plants (after card collected)
      visualPlant.innerHTML = getBotanicalIllustration(plant.id);
      visualPlant.style.filter = 'saturate(0.6) brightness(0.9) sepia(0.1)';
    } else {
      // Show growing seedling/sprout for early stages
      const stemHeight = 20 + (growthPercent * 40);
      const leafSize = growthPercent * 8;
      visualPlant.innerHTML = `
        <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));">
          <defs>
            <linearGradient id="stem-grad-${idx}" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#6b8e4e;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#4a6b35;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 50 120 Q 48 ${120 - stemHeight/2} 50 ${120 - stemHeight}" 
                stroke="url(#stem-grad-${idx})" stroke-width="3" fill="none" stroke-linecap="round"/>
          ${plant.stage >= plant.growth * 0.3 ? `
            <ellipse cx="42" cy="${120 - stemHeight/2}" rx="${leafSize}" ry="${leafSize * 1.5}" 
                     fill="#6b8e4e" opacity="0.8" transform="rotate(-30 42 ${120 - stemHeight/2})"/>
            <ellipse cx="58" cy="${120 - stemHeight/2 + 5}" rx="${leafSize}" ry="${leafSize * 1.5}" 
                     fill="#6b8e4e" opacity="0.8" transform="rotate(30 58 ${120 - stemHeight/2 + 5})"/>
          ` : ''}
          ${plant.stage >= plant.growth * 0.7 ? `
            <circle cx="50" cy="${120 - stemHeight}" r="${4 + growthPercent * 6}" 
                    fill="#d4af37" opacity="0.6"/>
          ` : ''}
        </svg>
      `;
      visualPlant.style.animation = `grow ${2}s ease-out`;
    }
    
    visualPlant.style.transition = 'all 0.3s ease';
    visualPlant.addEventListener('click', () => handlePlotClick(idx));
    
    plantsContainer.appendChild(visualPlant);
  });
}

function renderSeedShop() {
  const shop = document.getElementById('seed-shop');
  shop.innerHTML = '';
  
  FLOWER_TYPES.forEach(flower => {
    if (flower.locked && !GameState.upgrades.includes(`unlock-${flower.id}`)) return;
    
    const seedCard = document.createElement('div');
    seedCard.className = 'seed-card';
    if (GameState.selectedSeed === flower.id) seedCard.classList.add('selected');
    
    seedCard.innerHTML = `
      <div class="flower-visual" data-color="${flower.color}">✿</div>
      <div class="seed-name"><em>${flower.name}</em></div>
      <div class="seed-common">${flower.common}</div>
      <div class="seed-cost">$${flower.cost}</div>
      <div class="seed-info">Growth: ${flower.growth} | Water: ${flower.water}</div>
    `;
    
    seedCard.addEventListener('click', () => selectSeed(flower.id));
    shop.appendChild(seedCard);
  });
}

function renderInventory() {
  const inv = document.getElementById('inventory');
  inv.innerHTML = '';
  
  if (GameState.inventory.length === 0) {
    inv.innerHTML = '<p class="hint">No harvested flowers yet</p>';
    return;
  }
  
  const counts = {};
  GameState.inventory.forEach(flower => {
    counts[flower.id] = (counts[flower.id] || 0) + 1;
  });
  
  Object.entries(counts).forEach(([id, count]) => {
    const flower = FLOWER_TYPES.find(f => f.id === id);
    const item = document.createElement('div');
    item.className = 'inventory-item';
    item.innerHTML = `
      <div class="flower-visual" data-color="${flower.color}">✿</div>
      <div class="inv-name-box">
        <div class="inv-scientific"><em>${flower.name}</em></div>
        <div class="inv-common">${flower.common}</div>
      </div>
      <span class="inv-count">×${count}</span>
    `;
    item.addEventListener('click', () => addToBouquet(flower));
    inv.appendChild(item);
  });
}

function renderHerbarium() {
  const herbarium = document.getElementById('herbarium');
  herbarium.innerHTML = '';
  
  if (GameState.collectedCards.length === 0) {
    herbarium.innerHTML = '<p class="hint">Collect botanical illustrations by growing each flower species</p>';
    return;
  }
  
  GameState.collectedCards.forEach(flowerId => {
    const flower = FLOWER_TYPES.find(f => f.id === flowerId);
    if (!flower) return;
    
    const card = document.createElement('div');
    card.className = 'botanical-card';
    card.innerHTML = `
      <div class="card-illustration">
        ${getBotanicalIllustration(flowerId)}
      </div>
      <div class="card-info">
        <div class="card-scientific"><em>${flower.name}</em></div>
        <div class="card-common">${flower.common}</div>
      </div>
    `;
    herbarium.appendChild(card);
  });
  
  // Show collection progress
  const progress = document.createElement('div');
  progress.className = 'herbarium-progress';
  progress.innerHTML = `<small>Collected: ${GameState.collectedCards.length} / ${FLOWER_TYPES.length} species</small>`;
  herbarium.appendChild(progress);
}

function renderMarketDemand() {
  const demand = document.getElementById('market-demand');
  demand.innerHTML = '';
  
  Object.entries(GameState.marketDemand).forEach(([id, multiplier]) => {
    const flower = FLOWER_TYPES.find(f => f.id === id);
    const item = document.createElement('div');
    item.className = 'demand-item';
    const percent = Math.round(multiplier * 100);
    item.innerHTML = `
      <div class="flower-visual" data-color="${flower.color}">✿</div>
      <span class="demand-flower-name">${flower.common}:</span>
      <span class="demand-value">${percent}%</span>
    `;
    if (multiplier > 1.2) item.classList.add('high-demand');
    if (multiplier < 0.9) item.classList.add('low-demand');
    demand.appendChild(item);
  });
}

function renderBouquetsForSale() {
  const container = document.getElementById('bouquets-for-sale');
  container.innerHTML = '';
  
  if (GameState.bouquets.length === 0) {
    container.innerHTML = '<p class="hint">No arrangements ready for market</p>';
    return;
  }
  
  GameState.bouquets.forEach((bouquet, idx) => {
    const card = document.createElement('div');
    card.className = 'bouquet-card';
    card.innerHTML = `
      <div class="bouquet-flowers">${bouquet.flowers.map(f => f.emoji).join(' ')}</div>
      <div class="bouquet-value">Value: $${bouquet.value}</div>
    `;
    container.appendChild(card);
  });
}

function renderCurrentBouquet() {
  const container = document.getElementById('current-bouquet');
  container.innerHTML = '';
  
  if (GameState.currentBouquet.length === 0) {
    container.innerHTML = '<p class="hint">Select flowers from inventory</p>';
    document.getElementById('bouquet-value').textContent = '$0';
    return;
  }
  
  GameState.currentBouquet.forEach((flower, idx) => {
    const item = document.createElement('div');
    item.className = 'bouquet-flower';
    item.innerHTML = `<div class="flower-visual" data-color="${flower.color}" title="${flower.common}">\u273f</div>`;
    item.addEventListener('click', () => removeFromBouquet(idx));
    container.appendChild(item);
  });
  
  const value = calculateBouquetValue(GameState.currentBouquet);
  document.getElementById('bouquet-value').textContent = `$${value}`;
}

// ========== GAME LOGIC ==========
function selectSeed(seedId) {
  GameState.selectedSeed = seedId;
  renderSeedShop();
  showNotification(`Selected ${FLOWER_TYPES.find(f => f.id === seedId).name} seed`);
}

function plantSeed(plotIdx) {
  if (!GameState.selectedSeed) {
    showNotification('Please select a seed first!', 'warning');
    return;
  }
  
  if (GameState.garden[plotIdx]) {
    showNotification('Plot already occupied!', 'warning');
    return;
  }
  
  const flower = FLOWER_TYPES.find(f => f.id === GameState.selectedSeed);
  
  if (GameState.money < flower.cost) {
    showNotification('Not enough money!', 'error');
    return;
  }
  
  GameState.money -= flower.cost;
  GameState.garden[plotIdx] = {
    ...flower,
    stage: 0,
    watered: 0
  };
  
  showNotification(`Planted ${flower.name}!`, 'success');
  render();
}

function handlePlotClick(plotIdx) {
  const plant = GameState.garden[plotIdx];
  if (!plant) return;
  
  if (plant.stage >= plant.growth) {
    harvestPlant(plotIdx);
  } else {
    waterPlant(plotIdx);
  }
}

function waterPlant(plotIdx) {
  const plant = GameState.garden[plotIdx];
  if (!plant) return;
  
  if (plant.watered >= plant.water) {
    showNotification('Already well watered!', 'info');
    return;
  }
  
  plant.watered++;
  showNotification(`Watered ${plant.name}`, 'success');
  render();
}

function waterAll() {
  const cost = 5 - GameState.toolLevel;
  
  if (GameState.money < cost) {
    showNotification('Not enough money!', 'error');
    return;
  }
  
  GameState.money -= cost;
  let count = 0;
  
  GameState.garden.forEach(plant => {
    if (plant && plant.watered < plant.water) {
      plant.watered++;
      count++;
    }
  });
  
  showNotification(`Watered ${count} plants for $${cost}`, 'success');
  render();
}

function advanceDay() {
  GameState.garden.forEach(plant => {
    if (plant && plant.watered >= plant.water && plant.stage < plant.growth) {
      plant.stage++;
      plant.watered = 0;
    }
  });
  
  GameState.day++;
  showNotification('Day advanced. Plants have grown!', 'info');
  render();
}

function harvestPlant(plotIdx) {
  const plant = GameState.garden[plotIdx];
  if (!plant || plant.stage < plant.growth) return;
  
  GameState.inventory.push({ ...plant });
  GameState.garden[plotIdx] = null;
  
  // Track species for specimen notebook
  if (!GameState.grownSpecies.includes(plant.id)) {
    GameState.grownSpecies.push(plant.id);
  }
  
  // Unlock botanical card if this is the first time harvesting this species
  if (!GameState.collectedCards.includes(plant.id)) {
    GameState.collectedCards.push(plant.id);
    showNotification(`✨ New botanical illustration unlocked: ${plant.common}!`, 'success');
    renderHerbarium();
  } else {
    showNotification(`Harvested ${plant.name}!`, 'success');
  }
  
  render();
}

function addToBouquet(flower) {
  const idx = GameState.inventory.findIndex(f => f.id === flower.id);
  if (idx === -1) return;
  
  GameState.currentBouquet.push(GameState.inventory.splice(idx, 1)[0]);
  renderCurrentBouquet();
  renderInventory();
}

function removeFromBouquet(idx) {
  const flower = GameState.currentBouquet.splice(idx, 1)[0];
  GameState.inventory.push(flower);
  renderCurrentBouquet();
  renderInventory();
}

function calculateBouquetValue(flowers) {
  if (flowers.length === 0) return 0;
  
  let value = 0;
  flowers.forEach(flower => {
    const demand = GameState.marketDemand[flower.id] || 1;
    value += Math.round(flower.baseValue * demand);
  });
  
  // Bonus for variety
  const uniqueTypes = new Set(flowers.map(f => f.id)).size;
  if (uniqueTypes >= 3) value = Math.round(value * 1.3);
  else if (uniqueTypes >= 2) value = Math.round(value * 1.15);
  
  return value;
}

function completeBouquet() {
  if (GameState.currentBouquet.length === 0) {
    showNotification('Add flowers to the arrangement first!', 'warning');
    return;
  }
  
  const value = calculateBouquetValue(GameState.currentBouquet);
  GameState.bouquets.push({
    flowers: [...GameState.currentBouquet],
    value: value
  });
  
  GameState.currentBouquet = [];
  showNotification(`Arrangement completed! Worth $${value}`, 'success');
  renderCurrentBouquet();
  renderBouquetsForSale();
}

function generateMarketDemand() {
  GameState.marketDemand = {};
  FLOWER_TYPES.forEach(flower => {
    GameState.marketDemand[flower.id] = 0.7 + Math.random() * 0.9; // 0.7 to 1.6
  });
}

function endWeek() {
  if (GameState.bouquets.length === 0) {
    showNotification('No arrangements to sell!', 'warning');
    return;
  }
  
  let total = 0;
  GameState.bouquets.forEach(bouquet => {
    total += bouquet.value;
  });
  
  GameState.money += total;
  GameState.bouquets = [];
  GameState.week++;
  GameState.day = 1;
  
  generateMarketDemand();
  showNotification(`Week concluded! Sold arrangements for $${total}`, 'success');
  render();
}

// ========== UPGRADES ==========
function openUpgrades() {
  document.getElementById('upgrade-modal').classList.remove('hidden');
  renderUpgrades();
}

function closeUpgrades() {
  document.getElementById('upgrade-modal').classList.add('hidden');
}

function renderUpgrades() {
  const list = document.getElementById('upgrades-list');
  list.innerHTML = '';
  
  UPGRADES.forEach(upgrade => {
    if (GameState.upgrades.includes(upgrade.id)) return;
    
    // Check if upgrade is available
    if (upgrade.type === 'garden' && upgrade.value <= GameState.gardenSize) return;
    
    const card = document.createElement('div');
    card.className = 'upgrade-card';
    card.innerHTML = `
      <div class="upgrade-name">${upgrade.name}</div>
      <div class="upgrade-cost">Cost: $${upgrade.cost}</div>
      <button class="action-btn upgrade-btn" ${GameState.money < upgrade.cost ? 'disabled' : ''}>Purchase</button>
    `;
    
    card.querySelector('.upgrade-btn').addEventListener('click', () => purchaseUpgrade(upgrade));
    list.appendChild(card);
  });
}

function purchaseUpgrade(upgrade) {
  if (GameState.money < upgrade.cost) return;
  
  GameState.money -= upgrade.cost;
  GameState.upgrades.push(upgrade.id);
  
  if (upgrade.type === 'garden') {
    const oldSize = GameState.gardenSize;
    GameState.gardenSize = upgrade.value;
    const newGarden = [];
    for (let i = 0; i < upgrade.value * upgrade.value; i++) {
      if (i < oldSize * oldSize) {
        newGarden.push(GameState.garden[i]);
      } else {
        newGarden.push(null);
      }
    }
    GameState.garden = newGarden;
  } else if (upgrade.type === 'tool') {
    GameState.toolLevel += upgrade.value;
  }
  
  showNotification(`Purchased: ${upgrade.name}!`, 'success');
  renderUpgrades();
  render();
}

// ========== MODALS ==========
function selectWrapper(wrapper) {
  GameState.selectedWrapper = wrapper;
  document.querySelectorAll('.wrapper-option').forEach(opt => {
    opt.classList.toggle('selected', opt.dataset.wrapper === wrapper);
  });
  updateArrangementScores();
}

function selectRibbon(color) {
  GameState.selectedRibbon = color;
  document.querySelectorAll('.ribbon-option').forEach(opt => {
    opt.classList.toggle('selected', opt.dataset.color === color);
  });
  updateArrangementScores();
}

function clearArrangement() {
  GameState.arrangementFlowers.forEach(flower => {
    GameState.inventory.push(flower.data);
  });
  GameState.arrangementFlowers = [];
  GameState.selectedArrangementFlower = null;
  renderShopFlowers();
  renderArrangementCanvas();
  updateArrangementScores();
}

function rotateSelectedFlower(clockwise = true) {
  if (GameState.selectedArrangementFlower !== null) {
    const flower = GameState.arrangementFlowers[GameState.selectedArrangementFlower];
    const sensitivity = GameState.rotationSensitivity || 3;
    const delta = clockwise ? sensitivity : -sensitivity;
    flower.rotation = (flower.rotation + delta + 360) % 360;
    renderArrangementCanvas();
  }
}

function copySelectedFlower() {
  if (GameState.selectedArrangementFlower !== null) {
    const original = GameState.arrangementFlowers[GameState.selectedArrangementFlower];
    
    // Check if we have another of this flower in inventory
    const availableIndex = GameState.inventory.findIndex(f => f.id === original.data.id);
    if (availableIndex === -1) {
      showNotification('No more ' + original.data.common + ' available in inventory!', 'error');
      return;
    }
    
    // Remove from inventory
    GameState.inventory.splice(availableIndex, 1);
    
    // Create copy
    const copy = {
      data: original.data,
      x: original.x + 40,
      y: original.y + 40,
      rotation: original.rotation,
      scale: original.scale
    };
    GameState.arrangementFlowers.push(copy);
    GameState.selectedArrangementFlower = GameState.arrangementFlowers.length - 1;
    renderArrangementCanvas();
    renderShopFlowers(); // Update available flowers
    updateArrangementScores();
  }
}

function setStraight() {
  if (GameState.selectedArrangementFlower !== null) {
    const flower = GameState.arrangementFlowers[GameState.selectedArrangementFlower];
    flower.rotation = 0;
    renderArrangementCanvas();
  }
}

function cycleSensitivity() {
  const sensitivities = [1, 3, 5, 15];
  const currentIndex = sensitivities.indexOf(GameState.rotationSensitivity || 3);
  const nextIndex = (currentIndex + 1) % sensitivities.length;
  GameState.rotationSensitivity = sensitivities[nextIndex];
  
  // Update dial visual
  const indicator = document.querySelector('.dial-indicator');
  const valueDisplay = document.getElementById('sensitivity-value');
  if (indicator) {
    const rotation = nextIndex * 45; // 0°, 45°, 90°, 135°
    indicator.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
  }
  if (valueDisplay) {
    valueDisplay.textContent = sensitivities[nextIndex] + '°';
  }
}

function resizeSelectedFlower(factor) {
  if (GameState.selectedArrangementFlower !== null) {
    const flower = GameState.arrangementFlowers[GameState.selectedArrangementFlower];
    flower.scale = Math.max(0.5, Math.min(2, flower.scale * factor));
    renderArrangementCanvas();
  }
}

function renderArrangementCanvas() {
  const canvas = document.getElementById('arrangement-flowers');
  if (!canvas) return;
  canvas.innerHTML = '';
  
  GameState.arrangementFlowers.forEach((flower, idx) => {
    const elem = document.createElement('div');
    elem.className = 'canvas-flower';
    if (GameState.selectedArrangementFlower === idx) elem.classList.add('selected');
    elem.style.left = flower.x + 'px';
    elem.style.top = flower.y + 'px';
    elem.style.transform = `rotate(${flower.rotation}deg) scale(${flower.scale})`;
    elem.innerHTML = getBotanicalIllustration(flower.data.id);
    
    // AutoCAD-style smooth dragging
    elem.addEventListener('mousedown', (e) => {
      e.preventDefault();
      GameState.selectedArrangementFlower = idx;
      renderArrangementCanvas();
      
      const canvasContainer = document.getElementById('arrangement-canvas');
      const rect = canvasContainer.getBoundingClientRect();
      
      // Store grab offset (where exactly user clicked on the flower)
      const grabOffsetX = e.clientX - rect.left - flower.x;
      const grabOffsetY = e.clientY - rect.top - flower.y;
      
      const onMouseMove = (moveEvent) => {
        moveEvent.preventDefault();
        // Smooth pixel-perfect positioning
        flower.x = moveEvent.clientX - rect.left - grabOffsetX;
        flower.y = moveEvent.clientY - rect.top - grabOffsetY;
        
        // Update position in real-time without full re-render
        elem.style.left = flower.x + 'px';
        elem.style.top = flower.y + 'px';
      };
      
      const onMouseUp = () => {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        updateArrangementScores(); // Update scores after placement
      };
      
      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    });
    
    canvas.appendChild(elem);
  });
}

function updateArrangementScores() {
  const flowerCount = GameState.arrangementFlowers.length;
  const uniqueTypes = new Set(GameState.arrangementFlowers.map(f => f.data.id)).size;
  
  // Define vase area (center of canvas, roughly where vase is)
  const vaseArea = { x: 150, y: 150, width: 140, height: 180 };
  
  // Check arrangement quality
  let inVaseCount = 0;
  let upsideDownCount = 0;
  let offTableCount = 0;
  let overlappingPenalty = 0;
  
  GameState.arrangementFlowers.forEach((flower, idx) => {
    // Check if in vase area
    if (flower.x > vaseArea.x - 50 && flower.x < vaseArea.x + 50 &&
        flower.y > vaseArea.y - 50 && flower.y < vaseArea.y + 80) {
      inVaseCount++;
    }
    
    // Check if upside down (rotation 135-225 degrees is bad)
    const normalizedRotation = ((flower.rotation % 360) + 360) % 360;
    if (normalizedRotation > 135 && normalizedRotation < 225) {
      upsideDownCount++;
    }
    
    // Check if off table (bottom 140px is table)
    if (flower.y > 260) {
      offTableCount++;
    }
    
    // Check for overlaps (flowers too close together)
    GameState.arrangementFlowers.forEach((other, otherIdx) => {
      if (idx !== otherIdx) {
        const distance = Math.sqrt(Math.pow(flower.x - other.x, 2) + Math.pow(flower.y - other.y, 2));
        if (distance < 20) overlappingPenalty += 0.1;
      }
    });
  });
  
  // Aesthetic score (penalized for bad placement)
  let aesthetic = Math.min(100, (flowerCount / 8) * 100);
  aesthetic -= (upsideDownCount * 15); // -15% per upside down flower
  aesthetic -= (offTableCount * 20); // -20% per flower off table
  aesthetic -= (overlappingPenalty * 10); // -10% for severe overlaps
  aesthetic = Math.max(0, aesthetic);
  const aestheticElem = document.getElementById('aesthetic-score');
  if (aestheticElem) aestheticElem.style.width = aesthetic + '%';
  
  // Trend score (based on market demand)
  let trendScore = 0;
  GameState.arrangementFlowers.forEach(flower => {
    const demand = GameState.marketDemand[flower.data.id] || 1;
    trendScore += (demand - 0.7) / 0.9 * 100;
  });
  const avgTrend = flowerCount > 0 ? trendScore / flowerCount : 0;
  const trendElem = document.getElementById('trend-score');
  if (trendElem) trendElem.style.width = Math.min(100, avgTrend) + '%';
  
  // Harmony score (based on variety and vase placement)
  let harmony = uniqueTypes >= 3 ? 100 : uniqueTypes >= 2 ? 70 : 40;
  const vasePercentage = flowerCount > 0 ? (inVaseCount / flowerCount) : 0;
  harmony = harmony * (0.4 + (vasePercentage * 0.6)); // Penalty if not in vase
  const harmonyElem = document.getElementById('harmony-score');
  if (harmonyElem) harmonyElem.style.width = Math.max(0, harmony) + '%';
  
  // Calculate total value with quality multiplier
  let value = 0;
  GameState.arrangementFlowers.forEach(flower => {
    const demand = GameState.marketDemand[flower.data.id] || 1;
    value += Math.round(flower.data.baseValue * demand);
  });
  
  // Quality multiplier (good arrangement = higher value)
  let qualityMultiplier = 1.0;
  qualityMultiplier += (vasePercentage * 0.3); // Up to +30% for flowers in vase
  qualityMultiplier -= (upsideDownCount / flowerCount) * 0.4; // -40% per upside down flower
  qualityMultiplier -= (offTableCount / flowerCount) * 0.5; // -50% per flower off table
  qualityMultiplier = Math.max(0.3, Math.min(1.5, qualityMultiplier)); // Clamp between 30%-150%
  
  value = Math.round(value * qualityMultiplier);
  
  // Bonuses
  const wrapperBonus = { classic: 1, elegant: 1.1, rustic: 1.05, luxury: 1.2 };
  value = Math.round(value * wrapperBonus[GameState.selectedWrapper]);
  if (uniqueTypes >= 3) value = Math.round(value * 1.3);
  else if (uniqueTypes >= 2) value = Math.round(value * 1.15);
  
  const valueElem = document.getElementById('arrangement-value');
  if (valueElem) valueElem.textContent = '$' + value;
  
  // Update trend hint
  const highDemand = Object.entries(GameState.marketDemand)
    .filter(([_, v]) => v > 1.2)
    .map(([k, _]) => FLOWER_TYPES.find(f => f.id === k)?.name)
    .filter(Boolean);
  
  const trendHint = document.querySelector('.trend-clue');
  if (trendHint && highDemand.length > 0) {
    trendHint.textContent = `"The latest fashion dictates ${highDemand.join(', ')} are most desired this week."`;
  }
}

function openFlowerShop() {
  document.getElementById('flower-shop-page').classList.remove('hidden');
  document.querySelector('.game-container').style.display = 'none';
  GameState.arrangementFlowers = [];
  renderShopFlowers();
  renderArrangementCanvas();
  updateArrangementScores();
}

function closeFlowerShop() {
  document.getElementById('flower-shop-page').classList.add('hidden');
  document.querySelector('.game-container').style.display = 'block';
}

function renderShopFlowers() {
  const container = document.getElementById('shop-available-flowers');
  container.innerHTML = '';
  
  if (GameState.inventory.length === 0) {
    container.innerHTML = '<p class="hint">No flowers available</p>';
    return;
  }
  
  const counts = {};
  GameState.inventory.forEach(flower => {
    counts[flower.id] = (counts[flower.id] || 0) + 1;
  });
  
  Object.entries(counts).forEach(([id, count]) => {
    const flower = FLOWER_TYPES.find(f => f.id === id);
    const item = document.createElement('div');
    item.className = 'shop-flower-item';
    item.innerHTML = `
      <div class="flower-visual">${getBotanicalIllustration(id)}</div>
      <span class="flower-label">${flower.common}</span>
      <span class="count">${count}</span>
    `;
    item.addEventListener('click', () => addFlowerToCanvas(flower));
    container.appendChild(item);
  });
}

function addFlowerToCanvas(flowerType) {
  const idx = GameState.inventory.findIndex(f => f.id === flowerType.id);
  if (idx === -1) return;
  
  const flower = GameState.inventory.splice(idx, 1)[0];
  GameState.arrangementFlowers.push({
    data: flower,
    x: Math.random() * 200 + 50,
    y: Math.random() * 200 + 50,
    rotation: Math.random() * 360,
    scale: 1
  });
  
  renderShopFlowers();
  renderArrangementCanvas();
  updateArrangementScores();
}

function createShopBouquet() {
  if (GameState.arrangementFlowers.length === 0) {
    showNotification('Add flowers to the arrangement first!', 'warning');
    return;
  }
  
  const flowers = GameState.arrangementFlowers.map(f => f.data);
  let value = 0;
  flowers.forEach(flower => {
    const demand = GameState.marketDemand[flower.id] || 1;
    value += Math.round(flower.baseValue * demand);
  });
  
  // Apply bonuses
  const uniqueTypes = new Set(flowers.map(f => f.id)).size;
  const wrapperBonus = { classic: 1, elegant: 1.1, rustic: 1.05, luxury: 1.2 };
  value = Math.round(value * wrapperBonus[GameState.selectedWrapper]);
  if (uniqueTypes >= 3) value = Math.round(value * 1.3);
  else if (uniqueTypes >= 2) value = Math.round(value * 1.15);
  
  GameState.bouquets.push({
    flowers: flowers,
    value: value,
    wrapper: GameState.selectedWrapper,
    ribbon: GameState.selectedRibbon
  });
  
  GameState.arrangementFlowers = [];
  showNotification(`Exquisite arrangement created! Worth $${value}`, 'success');
  closeFlowerShop();
  render();
}

function openHelp() {
  document.getElementById('help-modal').classList.remove('hidden');
}

function closeHelp() {
  document.getElementById('help-modal').classList.add('hidden');
}

function switchView(view) {
  if (view === 'grid') {
    document.getElementById('grid-view').classList.remove('hidden');
    document.getElementById('visual-view').classList.add('hidden');
    document.getElementById('grid-view-btn').classList.add('active');
    document.getElementById('visual-view-btn').classList.remove('active');
  } else {
    document.getElementById('grid-view').classList.add('hidden');
    document.getElementById('visual-view').classList.remove('hidden');
    document.getElementById('grid-view-btn').classList.remove('active');
    document.getElementById('visual-view-btn').classList.add('active');
  }
}

// ========== NOTIFICATIONS ==========
function showNotification(message, type = 'info') {
  const container = document.getElementById('notifications');
  const notif = document.createElement('div');
  notif.className = `notification ${type}`;
  notif.textContent = message;
  container.appendChild(notif);
  
  setTimeout(() => {
    notif.style.animation = 'slideOut 0.3s ease-in';
    setTimeout(() => notif.remove(), 300);
  }, 3000);
}


// ========== SPECIMEN NOTEBOOK ==========
const FLOWER_ENCYCLOPEDIA = {
  'rosa-gallica': {
    description: 'Rosa gallica, commonly known as the French Rose or Gallic Rose, is one of the oldest cultivated roses, dating back to ancient times. This species is native to southern and central Europe and western Asia. The flowers are typically deep pink to red, highly fragrant, and bloom in early summer.',
    facts: 'Rosa gallica has been cultivated since at least the 12th century and was widely grown in medieval monastery gardens for medicinal purposes. The petals retain their fragrance even when dried, making them popular for potpourri. This species is one of the parents of many modern rose varieties.',
    cultivation: 'Prefers full sun and well-drained soil. Hardy in zones 4-9. Forms compact bushes 3-4 feet tall. Requires minimal pruning compared to modern roses. Highly disease-resistant and drought-tolerant once established.'
  },
  'rosa-chinensis': {
    description: 'Rosa chinensis, the China Rose, revolutionized rose breeding when introduced to Europe in the 18th century. Native to southwest China, this rose brought the ability to bloom repeatedly throughout the season, a trait absent in European roses.',
    facts: 'China Roses were cultivated in Chinese gardens for over a thousand years before reaching Europe. They bloom continuously from spring to frost, unlike European roses which bloom once. The famous \'Old Blush\' China rose, introduced in 1752, is still grown today.',
    cultivation: 'Thrives in zones 7-9, needs protection in colder climates. Requires fertile, well-drained soil and regular watering. Responds well to light pruning. More tender than European roses but offers unmatched repeat blooming.'
  },
  'bellis-perennis': {
    description: 'Bellis perennis, the Common Daisy or English Daisy, is a perennial herbaceous plant native to western, central, and northern Europe. The cheerful white petals with yellow centers have made it a beloved garden flower for centuries.',
    facts: 'The name "daisy" comes from "day\'s eye" because the flowers close at night and open at dawn. In medieval times, daisies symbolized innocence and were associated with the Virgin Mary. The plant has been used in traditional medicine for bruises and wounds.',
    cultivation: 'Extremely hardy, grows in zones 4-8. Prefers full sun to partial shade and moist, well-drained soil. Self-seeds readily and can naturalize in lawns. Blooms from early spring through fall. Edible flowers can be used in salads.'
  },
  'leucanthemum-vulgare': {
    description: 'Leucanthemum vulgare, the Oxeye Daisy, is a perennial wildflower native to Europe and temperate Asia. Larger than the common daisy, it features distinctive white rays surrounding a golden disk, blooming prolifically in meadows and roadsides.',
    facts: 'This plant was introduced to North America in the 1700s and quickly naturalized. The flowers track the sun throughout the day, a behavior called heliotropism. Children traditionally use oxeye daisies for the game "he loves me, he loves me not."',
    cultivation: 'Hardy in zones 3-9. Extremely adaptable to various soil types. Prefers full sun. Can become invasive in some regions. Excellent for wildflower meadows and pollinator gardens. Drought-tolerant once established.'
  },
  'lilium-candidum': {
    description: 'Lilium candidum, the Madonna Lily, is one of the oldest cultivated plants, with depictions found in Minoan frescoes from 1580 BC. Native to the Balkans and West Asia, this pure white lily has deep religious and cultural significance.',
    facts: 'Associated with the Virgin Mary in Christian art, symbolizing purity and virtue. Unlike most lilies, it produces autumn foliage that persists through winter. The bulbs were used medicinally in ancient Greece and Rome. Intensely fragrant, especially at night.',
    cultivation: 'Grows in zones 6-9. Unique among lilies, it requires shallow planting with the bulb top just below soil surface. Prefers alkaline soil. Plant in late summer for spring blooms. Susceptible to botrytis in humid conditions.'
  },
  'lilium-martagon': {
    description: 'Lilium martagon, the Turk\'s Cap Lily, is native to Europe and Asia. Named for the distinctive recurved petals that resemble a Turkish turban, this woodland lily produces whorls of nodding, spotted flowers on tall stems.',
    facts: 'One of the earliest lilies to be cultivated in European gardens. Can live for decades and improves with age. The bulbs were once eaten in Siberia during famines. Extremely cold-hardy and shade-tolerant compared to most lilies.',
    cultivation: 'Hardy to zone 3. Prefers partial shade and humus-rich, well-drained soil. Very slow to establish but long-lived once settled. Can take 2-3 years to bloom from bulb. Plant bulbs deep, at least 6 inches. Deer-resistant.'
  },
  'tulipa-gesneriana': {
    description: 'Tulipa gesneriana, the Didier\'s Tulip, is the primary ancestor of most cultivated tulips. Native to Turkey and Central Asia, tulips were introduced to Europe in the 16th century, sparking "Tulip Mania" in 1637 Holland.',
    facts: 'During Tulip Mania, a single bulb could cost more than a house. The Ottoman Empire cultivated tulips for centuries before they reached Europe. Tulip petals are edible and were eaten during Dutch famine in WWII.',
    cultivation: 'Grows in zones 3-8. Requires cold winter dormancy. Plant bulbs in fall, 6-8 inches deep. Needs full sun and well-drained soil. After blooming, allow foliage to yellow naturally. Can be treated as annuals in warm climates.'
  },
  'tulipa-clusiana': {
    description: 'Tulipa clusiana, the Lady Tulip or Candy Tulip, is a delicate species tulip from Iran and the Middle East. Its elegant white and red striped petals open wide in sunlight and close at night, creating a starry effect.',
    facts: 'Named after Carolus Clusius, the botanist who first cultivated tulips in the Netherlands. Unlike hybrid tulips, species tulips reliably perennialize and multiply. The narrow, grass-like foliage blends easily into gardens.',
    cultivation: 'Hardy in zones 4-8. More heat-tolerant than most tulips. Prefers full sun and excellent drainage. Plant 4-6 inches deep. Returns year after year, unlike many hybrid tulips. Excellent for rock gardens and naturalizing.'
  },
  'lavandula-angustifolia': {
    description: 'Lavandula angustifolia, English Lavender, is a fragrant Mediterranean shrub prized for its aromatic flowers and foliage. Despite its common name, it originates from the Mediterranean region, not England.',
    facts: 'Romans used lavender to scent bathwater - the name derives from Latin "lavare" (to wash). Dried lavender retains scent for years, making it ideal for sachets and potpourri. Lavender oil has antiseptic and calming properties documented since ancient times.',
    cultivation: 'Grows in zones 5-9. Requires full sun and excellent drainage - hates wet roots. Drought-tolerant once established. Prune after flowering to maintain compact shape. Sandy or gravelly soil is ideal. Deer and rabbit resistant.'
  },
  'lavandula-stoechas': {
    description: 'Lavandula stoechas, Spanish Lavender or French Lavender, features distinctive "rabbit ear" bracts atop dense flower spikes. Native to the Mediterranean, it blooms earlier than English lavender with a more resinous scent.',
    facts: 'The species name references the Stoechades Islands off southern France where it grew abundantly. More ornamental but less cold-hardy than English lavender. The unusual bracts are actually modified leaves, not petals.',
    cultivation: 'Hardy in zones 7-9, needs winter protection in colder areas. Even more drought-demanding than English lavender. Prefers acidic to neutral soil. Continuous bloomer from spring to summer. Excellent in containers. Cut back hard after flowering.'
  }
};

function openSpecimenNotebook() {
  document.getElementById('specimen-notebook-modal').classList.remove('hidden');
  renderSpecimenList();
}

function closeSpecimenNotebook() {
  document.getElementById('specimen-notebook-modal').classList.add('hidden');
}

function renderSpecimenList() {
  const list = document.getElementById('specimen-list');
  list.innerHTML = '';
  
  if (GameState.grownSpecies.length === 0) {
    list.innerHTML = '<p class="hint">No specimens cultivated yet. Grow your first flower to begin your botanical collection!</p>';
    return;
  }
  
  GameState.grownSpecies.forEach(flowerId => {
    const flower = FLOWER_TYPES.find(f => f.id === flowerId);
    const encyclopedia = FLOWER_ENCYCLOPEDIA[flowerId];
    
    if (!flower) return;
    
    const entry = document.createElement('div');
    entry.className = 'specimen-entry';
    
    const illustration = getBotanicalIllustration ? getBotanicalIllustration(flowerId) : '';
    
    entry.innerHTML = `
      <div class="specimen-header">
        <div class="specimen-illustration">${illustration}</div>
        <div class="specimen-title">
          <h3>${flower.common}</h3>
          <p class="scientific-name"><em>${flower.name}</em></p>
          <p class="flower-family">Family: ${flower.color} series</p>
        </div>
      </div>
      <div class="specimen-body">
        ${encyclopedia ? `
          <div class="specimen-section">
            <h4>Description</h4>
            <p>${encyclopedia.description}</p>
          </div>
          <div class="specimen-section">
            <h4>Historical & Cultural Facts</h4>
            <p>${encyclopedia.facts}</p>
          </div>
          <div class="specimen-section">
            <h4>Cultivation Notes</h4>
            <p>${encyclopedia.cultivation}</p>
          </div>
        ` : `
          <div class="specimen-section">
            <p>A beautiful ${flower.color} flowering plant. Further botanical documentation pending.</p>
          </div>
        `}
      </div>
    `;
    
    list.appendChild(entry);
  });
  
  // Add progress indicator
  const progress = document.createElement('div');
  progress.className = 'specimen-progress';
  progress.innerHTML = `<p><strong>Specimens Documented:</strong> ${GameState.grownSpecies.length} / ${FLOWER_TYPES.length} species</p>`;
  list.appendChild(progress);
}

</script>
</body>
</html>

